import{d as $t,l as ce,r as k,w as ye,a as Q,j as L,b as c,h as r,g as u,e as i,t as T,k as P,A as J,o as Ct,m as Vt,c as w,F as ne,D as W,i as ve,_ as Ut,I as He,q as Tt,p as tl,y as Mt,u as ll,G as al,s as N,Y as F,J as de,V as ol,T as nl,H as sl,Z as il,E as oe,n as st}from"./index-BUVdxLJQ.js";import{T as ul}from"./ProductSelectorDrawer-C8mZ5gyy.js";import{_ as rl}from"./ProductPriceHistoryDialog.vue_vue_type_script_setup_true_lang-ICVGsjnp.js";import{P as dl,B as cl,C as ml,_ as pl}from"./CustomerSalesHistoryDialog-CuIP_Uk5.js";const fl={style:{display:"flex","align-items":"center",gap:"12px"}},vl={style:{color:"#909399"}},yl=$t({__name:"MultiWarehouseDialog",props:{modelValue:{type:Boolean},goodsId:{},type:{},unitType:{},unit:{},bUnit:{},bRatio:{},isFixed:{type:Boolean}},emits:["update:modelValue","confirm"],setup(Be,{emit:be}){const B=Be,K=be,M=ce({get:()=>B.modelValue,set:m=>K("update:modelValue",m)}),X=k([]),se=ce(()=>{var m,R;return B.isFixed&&B.unitType==="large"&&((m=B.bUnit)!=null&&m.name)?B.bUnit.name:((R=B.unit)==null?void 0:R.name)||"小单位"}),x=ce(()=>B.isFixed&&B.unitType==="large"&&B.bRatio&&B.bRatio>0);ye(M,async m=>{m&&await Z()});async function Z(){var Y;const m=await J.goodsWarehouse({goods_id:B.goodsId,type:B.type??1}),R=Array.isArray(m.data)?m.data:((Y=m.data)==null?void 0:Y.data)||[];X.value=(R||[]).map(O=>{var z;return{...O,name:((z=O.warehouse)==null?void 0:z.name)||O.name,qty:"",originalStock:Number(O.stock||0)}})}function G(m){return x.value&&B.bRatio&&B.bRatio>0?Math.floor(m/B.bRatio):m}function me(){M.value=!1}function ie(m){if(x.value&&m.qty){const R=Number(m.qty);!isNaN(R)&&R>=0?m.qty=String(Math.floor(R)):m.qty=""}}function _e(){const m=X.value.map(z=>Number(z.qty||0)).filter(z=>z>0),R=X.value.map(z=>({warehouse_id:Number(z.warehouse_id||z.id),qty:Number(z.qty||0)})).filter(z=>z.qty>0),Y=x.value&&B.bRatio?R.map(z=>({...z,qty:Math.floor(z.qty)*B.bRatio})):R;let O=m.reduce((z,s)=>z+s,0);x.value&&(O=Math.floor(O)),K("confirm",{totalQty:O,details:Y}),M.value=!1}return(m,R)=>{const Y=Q("el-table-column"),O=Q("el-input"),z=Q("el-table"),s=Q("el-button"),U=Q("el-dialog");return c(),L(U,{modelValue:M.value,"onUpdate:modelValue":R[0]||(R[0]=j=>M.value=j),title:"选择仓库数量",width:"700px","append-to-body":""},{footer:r(()=>[u(s,{onClick:me},{default:r(()=>R[1]||(R[1]=[P("取消")])),_:1}),u(s,{type:"primary",onClick:_e},{default:r(()=>R[2]||(R[2]=[P("确认")])),_:1})]),default:r(()=>[u(z,{data:X.value,border:""},{default:r(()=>[u(Y,{label:"仓库","min-width":"300"},{default:r(j=>{var ue;return[i("div",fl,[i("span",null,T(((ue=j.row.warehouse)==null?void 0:ue.name)||j.row.name),1),i("span",vl,"库存"+T(G(j.row.originalStock||j.row.stock))+T(se.value),1)])]}),_:1}),u(Y,{label:"数量","min-width":"200"},{default:r(j=>[u(O,{modelValue:j.row.qty,"onUpdate:modelValue":ue=>j.row.qty=ue,placeholder:`请输入数量(${se.value})`,onBlur:ue=>ie(j.row)},{append:r(()=>[P(T(se.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onBlur"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),bl={key:0,class:"header-sub"},_l={class:"row",style:{"margin-bottom":"10px"}},gl={key:1,class:"form-grid"},hl={key:0,class:"group-title"},kl={key:1,class:"row"},xl={class:"label"},wl={class:"flex-row"},Vl={key:2,class:"row"},$l={class:"label"},Nl={class:"flex-row"},Pl={class:"row"},Sl={class:"label"},Tl={class:"flex-row"},Cl={class:"row"},Ul={class:"label"},ql={class:"flex-row"},Il={key:2,class:"form-grid"},Ql={class:"row"},zl={class:"label"},Dl={class:"flex-row"},Fl={class:"row"},Bl={class:"label"},Ll={class:"flex-row"},El={key:0,class:"row"},Rl={class:"label"},Ml={key:3,class:"row",style:{"margin-top":"10px"}},Al={class:"flex-row",style:{gap:"10px",width:"100%"}},Hl=$t({__name:"ProductQuantityDialog",props:{modelValue:{type:Boolean},product:{}},emits:["update:modelValue","confirm","history","cancel","viewHistoryPrice"],setup(Be,{emit:be}){Ct(()=>{console.log("Order ProductQuantityDialog mounted",B.product)});const B=Be,K=be,M=ce({get:()=>B.modelValue,set:n=>K("update:modelValue",n)});ye(M,async n=>{n&&(U(),await X())});async function X(){var a,_;const n=Number(((a=x.value)==null?void 0:a.id)||0);if(!n){Z.value=[];return}try{const b=await J.goodsWarehouse({goods_id:n,type:1});Z.value=Array.isArray(b.data)?b.data:((_=b.data)==null?void 0:_.data)||[]}catch{Z.value=[]}}const se=()=>{var D,q;if(!B.product)return"0";const n=[];let a=Number(B.product.stock||0);const _=((D=B.product.unit)==null?void 0:D.name)||"件",b=Number(B.product.b_ratio||0),S=(q=B.product.b_unit)==null?void 0:q.name;if(b>0&&a>=b&&S){const ee=Math.floor(a/b);ee>0&&(n.push(`${ee}${S}`),a=a%b)}return a>0&&n.push(`${a}${_}`),n.length>0?n.join(" "):`0${_}`},x=ce(()=>B.product),Z=k([]),G=k([]),me=k([]),ie=ce(()=>{var n;return Number((n=x.value)==null?void 0:n.is_quan)===1}),_e=ce(()=>{var S,D;const n=((D=(S=x.value)==null?void 0:S.unit)==null?void 0:D.name)||"小单位",a=Z.value&&Z.value.length>0?Z.value[0]:null;return`${Number((a==null?void 0:a.stock)??0)}${n}`}),m=Vt({small:{qty:"",price:""},large:{qty:"",price:""},subUnit:"",saleTypeId:"",basketId:"",basketQty:""}),R=k(!1),Y=k("small"),O=k({small:[],large:[]});function z(n){Y.value=n,R.value=!0}function s(n){const a=n.totalQty;Y.value==="small"&&(m.small.qty=String(a)),Y.value==="large"&&(m.large.qty=String(a)),O.value[Y.value]=n.details||[]}function U(){var n,a,_;m.small.qty="",m.small.price=((n=x.value)==null?void 0:n.price)||"",m.large.qty="",m.large.price=((a=x.value)==null?void 0:a.b_price)||"",m.subUnit="",m.saleTypeId=G.value.length>0&&((_=G.value[0])!=null&&_.id)?G.value[0].id:"",m.basketId="",m.basketQty="",O.value={small:[],large:[]}}function j(){x.value&&K("cancel",x.value),U(),M.value=!1}function ue(){x.value&&K("viewHistoryPrice",x.value)}function Se(){const n=ge(),a=le(),_=je(),b=Oe(m.saleTypeId),S=_e.value;x.value&&K("confirm",{product:x.value,amount:a,quantityText:n,..._,saleTypeId:Ve(m.saleTypeId),saleTypeName:b,basketId:Ve(m.basketId),basketQty:Ve(m.basketQty),stockText:S}),U(),M.value=!1}function ge(){var n,a,_,b,S,D;if(ie.value){const q=[];return m.large.qty&&((a=(n=x.value)==null?void 0:n.b_unit)!=null&&a.name)&&q.push(`${m.large.qty}${x.value.b_unit.name}`),m.small.qty&&q.push(`${m.small.qty}${((b=(_=x.value)==null?void 0:_.unit)==null?void 0:b.name)||"小单位"}`),q.join("")||""}return m.small.qty?`${m.small.qty}${((D=(S=x.value)==null?void 0:S.unit)==null?void 0:D.name)||"瓶"}`:""}function le(){const n=b=>b?Number(b):0;let a;if(ie.value){const b=n(m.small.qty)*n(m.small.price),S=n(m.large.qty)*n(m.large.price);a=+(b+S).toFixed(2)}else a=+(n(m.small.qty)*n(m.small.price)).toFixed(2);return Ve(m.saleTypeId)===2?-Math.abs(a):a}function We(){var S;const n=D=>D?Number(D):0,a=Number((S=x.value)==null?void 0:S.b_ratio)||0,_=n(m.small.qty),b=n(m.large.qty)*(a||0);return _+b}function je(){const n=q=>q?Number(q):0,a=ie.value?We():n(m.small.qty),_=le();let b;if(ie.value){const q=Math.abs(_);b=a>0?+(q/a).toFixed(4):void 0}else b=n(m.small.price)||void 0;const S={};(O.value.small||[]).forEach(q=>{S[q.warehouse_id]=(S[q.warehouse_id]||0)+Number(q.qty||0)}),(O.value.large||[]).forEach(q=>{S[q.warehouse_id]=(S[q.warehouse_id]||0)+Number(q.qty||0)});let D=Object.entries(S).filter(([,q])=>Number(q)>0).map(([q,ee])=>({warehouse_id:Number(q),qty:Number(ee)}));if(D.length===0&&a>0&&Z.value&&Z.value.length>0){const q=Z.value[0];q&&q.warehouse_id&&(D=[{warehouse_id:Number(q.warehouse_id),qty:a}])}return{smallQty:n(m.small.qty)||void 0,largeQty:n(m.large.qty)||void 0,smallPrice:n(m.small.price)||void 0,largePrice:n(m.large.price)||void 0,totalQtySmallUnits:a||void 0,unitPrice:b,f_stock:n(m.subUnit)||void 0,warehouseDetails:D}}function Ve(n){if(n===""||n===null||n===void 0)return;const a=Number(n);return Number.isFinite(a)?a:void 0}async function Ke(){var n,a;try{const _=await J.list("sale",{page:1,limit:10}),b=Array.isArray(_.data)?_.data:((n=_.data)==null?void 0:n.data)||[];G.value=b,b.length>0&&((a=b[0])!=null&&a.id)&&(m.saleTypeId=b[0].id)}catch{G.value=[]}}function Oe(n){const a=Number(n),_=G.value.find(b=>Number(b==null?void 0:b.id)===a);return(_==null?void 0:_.name)||(_==null?void 0:_.title)||(_==null?void 0:_.label)||(a?`类型${a}`:void 0)}async function v(){var n,a;try{const _=Number(((n=x.value)==null?void 0:n.id)||0),b=await J.depositList({page:1,limit:10,goods_id:_||void 0}),S=Array.isArray(b.data)?b.data:((a=b.data)==null?void 0:a.data)||[];me.value=S}catch{me.value=[]}}return ye(M,async n=>{n&&(U(),await Promise.all([X(),Ke(),v()]))}),ye(x,async()=>{M.value&&await v()}),(n,a)=>{var ee,Te,I,$e,he,Le;const _=Q("el-option"),b=Q("el-select"),S=Q("el-input"),D=Q("el-button"),q=Q("el-dialog");return c(),w(ne,null,[u(q,{modelValue:M.value,"onUpdate:modelValue":a[13]||(a[13]=xe=>M.value=xe),title:((ee=x.value)==null?void 0:ee.name)||((Te=x.value)==null?void 0:Te.productName)||"数量",width:"600px","append-to-body":"","destroy-on-close":""},{footer:r(()=>[u(D,{onClick:j},{default:r(()=>a[27]||(a[27]=[P("取消")])),_:1}),u(D,{type:"primary",onClick:Se},{default:r(()=>a[28]||(a[28]=[P("确认")])),_:1})]),default:r(()=>{var xe,Ee,Ge,it,Ye,ut,Ce,Ue,rt,dt,ct,Re,Me,mt,pt,ft,vt,yt,bt,_t,gt,ht,kt,xt;return[x.value?(c(),w("div",bl," 库存："+T(se()),1)):W("",!0),i("div",_l,[a[15]||(a[15]=i("div",{class:"label"},"销售类型",-1)),u(b,{modelValue:m.saleTypeId,"onUpdate:modelValue":a[0]||(a[0]=$=>m.saleTypeId=$),placeholder:"请选择销售类型",clearable:"",filterable:"",style:{width:"100%"}},{default:r(()=>[(c(!0),w(ne,null,ve(G.value,$=>(c(),L(_,{key:$.id,label:$.name||$.title||$.label||"类型"+$.id,value:$.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),ie.value?(c(),w("div",gl,[(xe=x.value)!=null&&xe.b_unit?(c(),w("div",hl,"大单位")):W("",!0),(Ee=x.value)!=null&&Ee.b_unit?(c(),w("div",kl,[i("div",xl,"数量（"+T(((it=(Ge=x.value)==null?void 0:Ge.b_unit)==null?void 0:it.name)||"大单位")+"）",1),i("div",wl,[u(S,{modelValue:m.large.qty,"onUpdate:modelValue":a[1]||(a[1]=$=>m.large.qty=$),placeholder:`数量(${((ut=(Ye=x.value)==null?void 0:Ye.b_unit)==null?void 0:ut.name)||"大单位"})`,class:"qty-input"},{append:r(()=>{var $,fe;return[P(T(((fe=($=x.value)==null?void 0:$.b_unit)==null?void 0:fe.name)||"大单位"),1)]}),_:1},8,["modelValue","placeholder"]),u(D,{type:"primary",link:"",class:"ml10",onClick:a[2]||(a[2]=$=>z("large"))},{default:r(()=>a[16]||(a[16]=[P("多仓库")])),_:1})])])):W("",!0),(Ce=x.value)!=null&&Ce.b_unit?(c(),w("div",Vl,[i("div",$l,"单价（元/"+T(((rt=(Ue=x.value)==null?void 0:Ue.b_unit)==null?void 0:rt.name)||"大单位")+"）",1),i("div",Nl,[u(S,{modelValue:m.large.price,"onUpdate:modelValue":a[3]||(a[3]=$=>m.large.price=$),placeholder:`单价(元/${((ct=(dt=x.value)==null?void 0:dt.b_unit)==null?void 0:ct.name)||"大单位"})`,class:"price-input"},{append:r(()=>a[17]||(a[17]=[P("元")])),_:1},8,["modelValue","placeholder"]),u(D,{type:"primary",link:"",class:"ml10",onClick:ue},{default:r(()=>a[18]||(a[18]=[P("历史价格")])),_:1})])])):W("",!0),a[22]||(a[22]=i("div",{class:"group-title"},"小单位",-1)),i("div",Pl,[i("div",Sl,"数量（"+T(((Me=(Re=x.value)==null?void 0:Re.unit)==null?void 0:Me.name)||"小单位")+"）",1),i("div",Tl,[u(S,{modelValue:m.small.qty,"onUpdate:modelValue":a[4]||(a[4]=$=>m.small.qty=$),placeholder:`数量(${((pt=(mt=x.value)==null?void 0:mt.unit)==null?void 0:pt.name)||"小单位"})`,class:"qty-input"},{append:r(()=>{var $,fe;return[P(T(((fe=($=x.value)==null?void 0:$.unit)==null?void 0:fe.name)||"小单位"),1)]}),_:1},8,["modelValue","placeholder"]),u(D,{type:"primary",link:"",class:"ml10",onClick:a[5]||(a[5]=$=>z("small"))},{default:r(()=>a[19]||(a[19]=[P("多仓库")])),_:1})])]),i("div",Cl,[i("div",Ul,"单价（元/"+T(((vt=(ft=x.value)==null?void 0:ft.unit)==null?void 0:vt.name)||"小单位")+"）",1),i("div",ql,[u(S,{modelValue:m.small.price,"onUpdate:modelValue":a[6]||(a[6]=$=>m.small.price=$),placeholder:`单价(元/${((bt=(yt=x.value)==null?void 0:yt.unit)==null?void 0:bt.name)||"小单位"})`,class:"price-input"},{append:r(()=>a[20]||(a[20]=[P("元")])),_:1},8,["modelValue","placeholder"]),u(D,{type:"primary",link:"",class:"ml10",onClick:ue},{default:r(()=>a[21]||(a[21]=[P("历史价格")])),_:1})])])])):(c(),w("div",Il,[i("div",Ql,[i("div",zl,"数量（"+T(((gt=(_t=x.value)==null?void 0:_t.unit)==null?void 0:gt.name)||"瓶")+"）",1),i("div",Dl,[u(S,{modelValue:m.small.qty,"onUpdate:modelValue":a[7]||(a[7]=$=>m.small.qty=$),placeholder:"请输入",class:"qty-input"},{append:r(()=>{var $,fe;return[P(T(((fe=($=x.value)==null?void 0:$.unit)==null?void 0:fe.name)||"瓶"),1)]}),_:1},8,["modelValue"]),u(D,{type:"primary",link:"",class:"ml10",onClick:a[8]||(a[8]=$=>z("small"))},{default:r(()=>a[23]||(a[23]=[P("多仓库")])),_:1})])]),i("div",Fl,[i("div",Bl,"单价（元/"+T(((kt=(ht=x.value)==null?void 0:ht.unit)==null?void 0:kt.name)||"瓶")+"）",1),i("div",Ll,[u(S,{modelValue:m.small.price,"onUpdate:modelValue":a[9]||(a[9]=$=>m.small.price=$),placeholder:"请输入",class:"price-input"},{append:r(()=>a[24]||(a[24]=[P("元")])),_:1},8,["modelValue"]),u(D,{type:"primary",link:"",class:"ml10",onClick:ue},{default:r(()=>a[25]||(a[25]=[P("历史价格")])),_:1})])]),(xt=x.value)!=null&&xt.f_unit?(c(),w("div",El,[i("div",Rl,"副单位（"+T(x.value.f_unit)+"）",1),u(S,{modelValue:m.subUnit,"onUpdate:modelValue":a[10]||(a[10]=$=>m.subUnit=$),placeholder:"请输入",class:"subunit-input"},{append:r(()=>[P(T(x.value.f_unit),1)]),_:1},8,["modelValue"])])):W("",!0)])),me.value.length>0?(c(),w("div",Ml,[a[26]||(a[26]=i("div",{class:"label"},"筐子选择",-1)),i("div",Al,[u(b,{modelValue:m.basketId,"onUpdate:modelValue":a[11]||(a[11]=$=>m.basketId=$),placeholder:"请选择筐子",clearable:"",filterable:"",style:{flex:"1"}},{default:r(()=>[(c(!0),w(ne,null,ve(me.value,$=>(c(),L(_,{key:$.id,label:$.name||$.title||$.label||"筐子"+$.id,value:$.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(S,{modelValue:m.basketQty,"onUpdate:modelValue":a[12]||(a[12]=$=>m.basketQty=$),placeholder:"数量",class:"qty-input",style:{flex:"1"}},null,8,["modelValue"])])])):W("",!0)]}),_:1},8,["modelValue","title"]),u(yl,{modelValue:R.value,"onUpdate:modelValue":a[14]||(a[14]=xe=>R.value=xe),"goods-id":Number(((I=x.value)==null?void 0:I.id)||0),type:1,"unit-type":Y.value,unit:($e=x.value)==null?void 0:$e.unit,"b-unit":(he=x.value)==null?void 0:he.b_unit,"b-ratio":(Le=x.value)==null?void 0:Le.b_ratio,"is-fixed":ie.value,onConfirm:s},null,8,["modelValue","goods-id","unit-type","unit","b-unit","b-ratio","is-fixed"])],64)}}}),Wl=Ut(Hl,[["__scopeId","data-v-21e5df2b"]]),jl={class:"drawer-wrapper"},Kl={class:"drawer-header"},Ol={class:"drawer-body"},Gl={class:"category-pane"},Yl={key:0,class:"loading-text"},Jl=["onClick"],Xl={class:"content-pane"},Zl={key:0,class:"loading-text"},ea={key:1,class:"card-grid"},ta=["onClick"],la={key:0,class:"product-img"},aa=["src","alt"],oa={class:"name-row"},na={class:"name"},sa={class:"sub"},ia={key:1,class:"sub"},ua={class:"pagination-row"},ra={class:"drawer-footer"},da={class:"tip"},ca={class:"actions"},Rt=12,ma=$t({__name:"ProductSelectorDownPop",props:{modelValue:{type:Boolean},selectedProducts:{},warehouseId:{}},emits:["update:modelValue","confirm","select","unselect"],setup(Be,{expose:be,emit:B}){const K=Be,M=B,X=ce({get:()=>K.modelValue,set:v=>M("update:modelValue",v)}),se=k(""),x=k(""),Z=k(""),G=k(""),me=k(!1),ie=k(!1),_e=k([]),m=v=>{if(!v||v.length===0)return[];if(v.some(b=>b.children&&b.children.length>0))return v.map(b=>({...b,children:b.children||[]}));const a={},_=[];return v.forEach(b=>{a[b.id]={...b,children:[]}}),v.forEach(b=>{const S=b.p_id;S&&S!==0&&a[S]?(a[S].children||(a[S].children=[]),a[S].children.push(a[b.id])):_.push(a[b.id])}),console.log("转换后的树形结构:",_),_},R=async()=>{try{me.value=!0;const v=await J.list("goods_cate",{page:1,limit:9999});if(v.code===1e4){const n=v.data||[],a=m(n);_e.value=a,_e.value.length>0&&ge(_e.value[0])}}catch(v){console.error("获取商品分类失败:",v)}finally{me.value=!1}},Y=k([]),O=k(0),z=k(new Set),s=ce(()=>Y.value.filter(v=>z.value.has(v.id))),U=async()=>{try{ie.value=!0;const v={page:j.value,limit:Rt};se.value.trim()&&(v.keyword=se.value.trim()),Z.value&&(v.cate_id=Z.value),K.warehouseId&&(v.warehouse_id=K.warehouseId);const n=await J.list("goods",v);n.code===1e4&&(Y.value=n.data||[],O.value=n.total||0)}catch(v){console.error("获取商品失败:",v)}finally{ie.value=!1}},j=k(1),ue=ce(()=>Y.value);function Se(){j.value=1,U()}function ge(v){x.value=v.name,Z.value=String(v.id);const n=_e.value.find(a=>{var _;return(_=a.children)==null?void 0:_.some(b=>b.id===v.id)});n?G.value=`c-${n.id}-${v.id}`:G.value=`c-${v.id}`,j.value=1,U()}async function le(v){if(z.value.has(v.id))try{await Mt.confirm(`确定要取消选中商品"${v.name}"吗？`,"确认取消选中",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),z.value.delete(v.id),M("unselect",v)}catch{}else M("select",v)}function We(v){var b,S,D,q;const n=[];let _=v.goodsWarehouse&&v.goodsWarehouse.length>0?Number(v.goodsWarehouse[0].stock||0):Number(v.stock||0);if(v.b_ratio>0&&_>=v.b_ratio&&((b=v.b_unit)!=null&&b.name)){const ee=Math.floor(_/v.b_ratio);ee>0&&(n.push(`${ee}${v.b_unit.name}`),_=_%v.b_ratio)}if(v.c_ratio>0&&_>=v.c_ratio&&((S=v.c_unit)!=null&&S.name)){const ee=Math.floor(_/v.c_ratio);ee>0&&(n.push(`${ee}${v.c_unit.name}`),_=_%v.c_ratio)}return _>0&&n.push(`${_}${(D=v.unit)==null?void 0:D.name}`),n.length>0?n.join(" "):`0${(q=v.unit)==null?void 0:q.name}`}function je(v){return v.goodsWarehouse&&v.goodsWarehouse.length>0?Number(v.goodsWarehouse[0].stock||0):Number(v.stock||0)}function Ve(){X.value=!1}function Ke(){s.value.length>0&&M("confirm",s.value),X.value=!1,console.log(s.value)}function Oe(v){z.value.has(v.id)&&(z.value.delete(v.id),M("unselect",v))}return be({unselectProduct:Oe}),Ct(()=>{R(),U()}),ye(()=>K.selectedProducts,v=>{v&&v.length>0?z.value=new Set(v.map(n=>n.id)):z.value.clear()},{immediate:!0}),ye(()=>K.modelValue,v=>{v&&K.selectedProducts&&K.selectedProducts.length>0&&(z.value=new Set(K.selectedProducts.map(n=>n.id)))}),(v,n)=>{const a=Q("el-button"),_=Q("el-input"),b=Q("el-menu-item"),S=Q("el-sub-menu"),D=Q("el-menu"),q=Q("el-tag"),ee=Q("el-pagination"),Te=Q("el-drawer");return c(),L(Te,{modelValue:X.value,"onUpdate:modelValue":n[2]||(n[2]=I=>X.value=I),"with-header":!1,size:"80%","append-to-body":""},{default:r(()=>[i("div",jl,[i("div",Kl,[n[4]||(n[4]=i("span",null,"选择商品",-1)),u(_,{modelValue:se.value,"onUpdate:modelValue":n[0]||(n[0]=I=>se.value=I),placeholder:"搜索编号/名称/条码",class:"search-input",clearable:"",onKeyup:He(Se,["enter","native"])},{append:r(()=>[u(a,{type:"primary",onClick:Se},{default:r(()=>n[3]||(n[3]=[P("搜索")])),_:1})]),_:1},8,["modelValue"])]),i("div",Ol,[i("div",Gl,[n[5]||(n[5]=i("div",{class:"category-title"},"商品分类",-1)),me.value?(c(),w("div",Yl,"加载中...")):(c(),L(D,{key:1,class:"category-menu","default-active":G.value},{default:r(()=>[(c(!0),w(ne,null,ve(_e.value,(I,$e)=>(c(),w(ne,{key:I.id||$e},[I.children&&I.children.length>0?(c(),L(S,{key:0,index:`c-${I.id}`},{title:r(()=>[i("span",{class:"category-title-clickable",onClick:Tt(he=>ge(I),["stop"])},T(I.name),9,Jl)]),default:r(()=>[(c(!0),w(ne,null,ve(I.children,(he,Le)=>(c(),L(b,{key:he.id||Le,index:`c-${I.id}-${he.id}`,onClick:xe=>ge(he)},{default:r(()=>[P(T(he.name),1)]),_:2},1032,["index","onClick"]))),128))]),_:2},1032,["index"])):(c(),L(b,{key:1,index:`c-${I.id}`,onClick:he=>ge(I)},{default:r(()=>[P(T(I.name),1)]),_:2},1032,["index","onClick"]))],64))),128))]),_:1},8,["default-active"]))]),i("div",Xl,[ie.value?(c(),w("div",Zl,"加载商品中...")):(c(),w("div",ea,[(c(!0),w(ne,null,ve(ue.value,I=>(c(),w("div",{key:I.id,class:tl(["product-card",{selected:z.value.has(I.id)}]),onClick:$e=>le(I)},[I.img?(c(),w("div",la,[i("img",{src:I.img,alt:I.name},null,8,aa)])):W("",!0),i("div",oa,[i("span",na,T(I.name),1),I.is_quan?(c(),L(q,{key:0,type:"primary",size:"small"},{default:r(()=>n[6]||(n[6]=[P("定")])),_:1})):W("",!0)]),i("div",sa,"存："+T(We(I)),1),I.is_quan?(c(),w("div",ia,"总："+T(je(I))+T(I.unit.name),1)):W("",!0)],10,ta))),128))])),i("div",ua,[u(ee,{background:"",layout:"prev, pager, next",total:O.value,"page-size":Rt,"current-page":j.value,"onUpdate:currentPage":n[1]||(n[1]=I=>j.value=I),onCurrentChange:U},null,8,["total","current-page"])])])]),i("div",ra,[i("div",da,"已选 "+T(z.value.size)+" 项",1),i("div",ca,[u(a,{onClick:Ve},{default:r(()=>n[7]||(n[7]=[P("取消")])),_:1}),u(a,{type:"primary",onClick:Ke},{default:r(()=>n[8]||(n[8]=[P("确认")])),_:1})])])])]),_:1},8,["modelValue"])}}}),pa=Ut(ma,[["__scopeId","data-v-dbf700ec"]]),fa={class:"page"},va={class:"padding10"},ya={class:"page-header"},ba={class:"header-controls"},_a={class:"header-item"},ga={class:"header-item"},ha={style:{"font-size":"13px"}},ka={class:"header-item",style:{"margin-left":"10px"}},xa={class:"header-item",style:{"margin-left":"10px"}},wa={class:"header-item"},Va={class:"section",style:{"margin-bottom":"24px"}},$a={class:"section-content mb10"},Na={style:{display:"flex","justify-content":"space-between"}},Pa={style:{display:"flex"}},Sa={class:"form-item"},Ta={style:{position:"relative",margin:"0 14px"}},Ca={class:"form-item"},Ua={class:"supplier-select"},qa={key:0,class:"debt-tip"},Ia={class:"form-item"},Qa={class:"section-content mb10"},za={style:{display:"flex"}},Da={class:"form-item"},Fa={class:"form-item",style:{"margin-left":"14px"}},Ba={class:"section-content"},La={class:"form-item"},Ea={class:"section mb20 padding10",style:{"margin-top":"10px"}},Ra={class:"section-content"},Ma={style:{"margin-bottom":"10px"}},Aa=["onMouseenter"],Ha={key:0,class:"index-text"},Wa={key:1,class:"button-group"},ja={key:0,class:"clickable-text"},Ka={key:0,class:"quantity-input-cell"},Oa=["onClick"],Ga={key:0},Ya={key:0,class:"quantity-input-cell"},Ja=["onClick"],Xa={key:0},Za={key:0,class:"quantity-input-cell"},eo=["onClick"],to={key:0},lo={class:"quantity-cell"},ao={key:0,class:"quantity-input-cell"},oo=["onClick"],no={key:0},so={key:0,class:"quantity-input-cell"},io=["onClick"],uo={key:0},ro={key:0,class:"amount-text"},co={key:0},mo={class:"section mb20 padding10"},po={class:"section-content"},fo={class:"form-item"},vo={class:"form-item"},yo={class:"flex-row"},bo={class:"form-item"},_o={class:"form-item"},go={class:"form-item"},ho={class:"summary"},ko={class:"total-amount"},xo={style:{width:"100%"}},wo=$t({__name:"createOrder",setup(Be){const be=ll(),B=al(),K=k(null),M=k(!1),X=k(null),se=k(!1),x=k([]),Z=k([]),G=k([]),me=k(""),ie=()=>{var t=[];G.value.forEach(e=>{e.id==s.supplier&&(t.push(e.phone),console.log(e,"-item ----------"),s.address=e.address,s.phone=e.phone)}),me.value=t[0]},_e=()=>{s.warehouse="",s.supplier="",me.value=""},m=()=>{be.push("/customer/list")},R=async()=>{try{const t=await J.staffList({page:1,limit:99999});t.code===1e4&&(x.value=t.data||[])}catch(t){console.error("获取员工列表失败:",t)}},Y=async()=>{try{const t=await J.warehouseList({page:1,limit:99999});t.code===1e4&&(Z.value=t.data||[])}catch(t){console.error("获取仓库列表失败:",t)}},O=async()=>{try{const t=await J.customerList({page:1,limit:99999});t.code===1e4&&(G.value=t.data||[])}catch(t){console.error("获取客户列表失败:",t)}},z=async t=>{try{const e=await J.orderDetail(t);if(e.code===1e4){const o=e.data;s.handler=o.staff_id||"",s.warehouse=o.json_text.warehouse_id||"",s.supplier=o.customer_id||o.supplier_id||"",s.remark=o.describe||"",s.documentNumber=o.order_sn||"",s.businessDate=o.time||"",s.purchaseTotal=o.order_price,s.payableTotal=o.order_price,s.images=o.file?o.file.split(",").filter(Boolean):[];const f=o.orderGoods||o.purchaseGoods||[];if(f&&f.length>0&&(U.value=f.map(g=>{var h;return $e({product:{id:g.goods_id,name:g.goods_name,number:g.goods_number||"",stock:g.stock||0,unit:g.unit||{name:"件"},c_unit:g.c_unit,b_unit:g.b_unit,f_unit:g.f_unit||null,f_stock:g.f_stock||0,is_quan:g.is_quan||!1,b_ratio:g.b_ratio},quantityText:`${g.num}${((h=g.unit)==null?void 0:h.name)||"件"}`,amount:g.price||0,totalQtySmallUnits:g.num||0,smallQty:g.num||0,f_stock:g.f_stock||0,itemRemark:g.mark||""})})),o.costs&&o.costs.length>0){le.value=o.costs.map(h=>{var p;return{item:((p=h.other_unit_id)==null?void 0:p.toString())||"",amount:(h.price||0).toString(),bearer:h.bear===1?"自己承担":"对方承担"}});const g=le.value.filter(h=>h.bearer==="对方承担").reduce((h,p)=>h+(parseFloat(p.amount)||0),0);s.expenseTotal=g.toFixed(2)}console.log(U.value,"-  productList.productListproductListproductListvalue"),$()}}catch(e){console.error("获取销售详情失败(临时复用):",e),oe.error("获取详情失败")}};k({});const s=Vt({phone:"",address:"",remark:"",handler:"",warehouse:"",supplier:"",documentNumber:"",businessDate:"",purchaseTotal:"0.00",expenseTotal:"0.00",depositTotal:"0.00",roundingAmount:"",payableTotal:"0.00",images:[]}),U=k([]),j=k(-1),ue=ce(()=>U.value.map(t=>t.product).filter(Boolean)),Se=k([]),ge=k(!1),le=k([{item:"",amount:"",bearer:"自己承担"}]),We=()=>{ge.value=!0},je=()=>{le.value.push({item:"",amount:"",bearer:"自己承担"})},Ve=t=>{le.value.splice(t,1)},Ke=()=>{const t=le.value.filter(e=>e.bearer==="对方承担").reduce((e,o)=>e+(parseFloat(o.amount)||0),0);s.expenseTotal=t.toFixed(2),ge.value=!1},Oe=async()=>{try{const t=await J.otherUnitList({page:1,limit:999});if((t==null?void 0:t.code)===1e4){const e=t.data||[];Se.value=e.map(o=>({label:o.name,value:o.id}))}}catch(t){console.error("获取费用项失败:",t)}},v=k(!1),n=k(!1),a=k(),_=k(),b=()=>{if(!s.warehouse){oe.error("请先选择仓库");return}n.value=!0},S=t=>{new Set(U.value.map(o=>{var f;return(f=o.product)==null?void 0:f.id})).has(t.id)||(Nt.value=t,Ae.value=!0)},D=t=>{const e=U.value.findIndex(o=>{var f;return((f=o.product)==null?void 0:f.id)===t.id});e!==-1&&U.value.splice(e,1),a.value&&a.value.unselectProduct(t),_.value&&_.value.unselectProduct(t)},q=k(-1),ee=t=>{if(q.value!==-1){const e={...U.value[q.value],product:t,quantityText:"0瓶",smallQty:0,amount:0,totalQtySmallUnits:0};U.value.splice(q.value,1,e),v.value=!1,q.value=-1}},Te=t=>{console.log(t,"选中后的商品-rows");const e=new Set(U.value.map(f=>{var g;return(g=f.product)==null?void 0:g.id}));console.log(e,"existingIds-rows");const o=t.filter(f=>!e.has(f.id));console.log(o,"newProductsnewProducts-rows"),o.length>0&&(Xe.value=o,I())},I=()=>{Xe.value.length>0&&(Nt.value=Xe.value.shift(),Ae.value=!0)};function $e(t){var ke,ae;const e=t.product||{};if(Number(e==null?void 0:e.is_quan)!==1)return t;const o=Number((e==null?void 0:e.b_ratio)||0);if(!o||o<=0)return t;const f=Number(t.totalQtySmallUnits??0)||Number(t.smallQty||0)+Number(t.largeQty||0)*o,g=Math.floor(f/o),h=f%o,p=((ke=e==null?void 0:e.unit)==null?void 0:ke.name)||"小单位",C=((ae=e==null?void 0:e.b_unit)==null?void 0:ae.name)||"大单位",y=[];g>0&&C&&y.push(`${g}${C}`),h>0&&y.push(`${h}${p}`),t.largeQty=g,t.smallQty=h,t.totalQtySmallUnits=f,t.quantityText=y.join("")||`0${p}`;const H=Number(t.smallPrice??(e==null?void 0:e.price)??t.price??0),te=Number(t.largePrice??(e==null?void 0:e.b_price)??t.price??0);let E=+(h*H+g*te).toFixed(2);Number(t.saleTypeId)===2&&(E=-Math.abs(E)),t.amount=E;const pe=H;return t.unitPrice=pe,t.price=pe,t}const he=t=>{const e=$e({...t,itemRemark:""}),o=U.value.findIndex(f=>{var g;return((g=f.product)==null?void 0:g.id)===null});o!==-1?U.value[o]=e:U.value.push(e),Ae.value=!1,Xe.value.length>0&&I()},Le=t=>{D(t),Ae.value=!1,Xe.value.length>0&&I()},xe=t=>{t&&t.product&&Qt()},Ee=k(!1),Ge=k([]),it=async t=>{var e;try{const o=await J.historyPrice(Number(t.id));Ge.value=((e=o.data)==null?void 0:e.data)||o.data||[],Ee.value=!0}catch(o){console.error("获取历史进价失败:",o),oe.error("获取历史进价失败")}},Ye=ce(()=>U.value.reduce((t,e)=>{var o;return((o=e.product)==null?void 0:o.id)!==null?t+e.amount:t},0)),ut=t=>{const{columns:e,data:o}=t;let f=0;return o.forEach(h=>{f+=Number(h.amount||0)}),e.map(h=>{var p;return h.type==="index"?"合计":(p=h.label)!=null&&p.includes("金额(元)")?f.toFixed(2):""})},Ce=k(!1),Ue=Vt([{id:"1",operate:"",name:"商品名字",showName:"商品名字",align:"default",column:!0,flex:"default"},{id:"2",operate:"",name:"条形码",showName:"条形码",align:"default",column:!0,flex:"default"},{id:"3",operate:"",name:"规格",showName:"规格",align:"center",column:!0,flex:"default"},{id:"4",operate:"",name:"销售类型",showName:"销售类型",align:"center",column:!0,flex:"default"},{id:"5",operate:"",name:"单位",showName:"单位",align:"center",column:!0,flex:"default"},{id:"6",operate:"",name:"数量",showName:"数量",align:"center",column:!0,flex:"default"},{id:"7",operate:"",name:"单价(小单位)",showName:"单价(小单位)",align:"center",column:!0,flex:"default"},{id:"8",operate:"",name:"副单位",showName:"副单位",align:"default",column:!0,flex:"default"},{id:"9",operate:"",name:"单位（大）",showName:"单位（大）",align:"default",column:!0,flex:"default"},{id:"10",operate:"",name:"数量（大单位）",showName:"数量（大单位）",align:"default",column:!0,flex:"default"},{id:"11",operate:"",name:"单价(大单位)",showName:"单价(大单位)",align:"default",column:!0,flex:"default"},{id:"12",operate:"",name:"金额(元)",showName:"金额(元)",align:"default",column:!0,flex:"default"},{id:"13",operate:"",name:"库存",showName:"库存",align:"default",column:!0,flex:"default"},{id:"14",operate:"",name:"单品备注",showName:"单品备注",align:"default",column:!0,flex:"default"}]),rt=()=>{Ce.value=!0},dt=t=>{Ue.splice(0,Ue.length,...t),Ce.value=!1},ct=ce(()=>Ue.filter(t=>t.column===!0)),Re=k({}),Me=k([]),mt=async()=>{var t;try{const e=await J.depositList({page:1,limit:9999}),o=Array.isArray(e.data)?e.data:((t=e.data)==null?void 0:t.data)||[],f={},g=[];o.forEach(h=>{if(h!=null&&h.id){const p=Number(h.id),C=Number(h.price||0);f[p]=C,g.push({id:p,name:h.name||`筐${p}`,price:C})}}),Re.value=f,Me.value=g}catch{Re.value={}}},pt=()=>{const t=Re.value||{},e=U.value.reduce((o,f)=>{var C;if(((C=f.product)==null?void 0:C.id)===null)return o;const g=Number(f.basketId||0),h=Number(f.basketQty||0),p=t[g]||0;return o+(g&&h?h*p:0)},0);s.depositTotal=e.toFixed(2)},ft=async()=>{try{const t=await J.getOrderXn();(t==null?void 0:t.code)===1e4&&(s.documentNumber=t.data||"")}catch(t){console.error("获取单据编号失败:",t),oe.error("获取单据编号失败")}},vt=t=>{s.images.push(t.data.path)},yt=t=>{U.value.splice(t,1)},bt=t=>{const e={product:{id:null}};U.value.splice(t,0,e)},_t=()=>{be.back()},gt=()=>{M.value?kt():ht()},ht=async()=>{var t,e;try{const o=y=>{if(!y)return"";const H=typeof y=="string"?new Date(y):y;if(Number.isNaN(H.getTime()))return"";const te=H.getFullYear(),E=String(H.getMonth()+1).padStart(2,"0"),pe=String(H.getDate()).padStart(2,"0");return`${te}-${E}-${pe}`},f=U.value.map(y=>{var we,Fe,Pe,l,d,V,A;const H=Number(((we=y.product)==null?void 0:we.id)||((Fe=y.product)==null?void 0:Fe.goods_id)||((Pe=y.product)==null?void 0:Pe.goodsId)||((l=y.product)==null?void 0:l.gid)||((d=y.product)==null?void 0:d.ID)||((V=y.product)==null?void 0:V.Id)||((A=y.product)==null?void 0:A.id)),te=Number(y.totalQtySmallUnits||y.smallQty||0),E=Number(y.amount||0),pe=y.itemRemark||"",ke=Number(y.f_stock||0),ae=y.basketId?Number(y.basketId):void 0,wt=y.basketQty?Number(y.basketQty):void 0,ot=y.saleTypeId?Number(y.saleTypeId):void 0,De=(y.warehouseDetails||[]).map(Et=>({warehouse_id:Et.warehouse_id,quantity:Et.qty}));return{goods_id:H,num:te,price:E,mark:pe,f_stock:ke,deposit_id:ae,deposit_num:wt,sale_id:ot,warehouse_distribution:De}}).filter(y=>y.goods_id&&y.num>0),g=le.value.map(y=>({price:Number(y.amount||0),bear:y.bearer==="自己承担"?1:2,other_unit_id:Number(y.item||0)})).filter(y=>y.price>0&&y.other_unit_id),h=le.value.map(y=>Number(y.item||0)).filter(y=>y>0).join(","),p={customer_id:s.supplier,staff_id:s.handler,warehouse_id:s.warehouse,order_sn:s.documentNumber,time:o(s.businessDate),describe:s.remark,file:(s.images||[]).join(","),money:Number(s.roundingAmount||0),order_price:Number(s.payableTotal||0),goods:f,costs:g,otherUnit_ids:h},C=await J.orderCreate(p);if((C==null?void 0:C.code)===1e4){const y=((t=C==null?void 0:C.data)==null?void 0:t.order_id)||((e=C==null?void 0:C.data)==null?void 0:e.id);if(K.value=y||null,y)try{await J.orderExamine({order_id:y})}catch(H){console.error("提交审核失败:",H)}try{await Mt.confirm("创建成功，是否前往收款？","提示",{confirmButtonText:"前往收款",cancelButtonText:"暂不",type:"success"}),Pt.value=!0}catch{be.back()}}}catch(o){console.error("新建销售单失败:",o),oe.error("新建销售单失败")}},kt=async()=>{try{const t=p=>{if(!p)return"";const C=typeof p=="string"?new Date(p):p;if(Number.isNaN(C.getTime()))return"";const y=C.getFullYear(),H=String(C.getMonth()+1).padStart(2,"0"),te=String(C.getDate()).padStart(2,"0");return`${y}-${H}-${te}`},e=U.value.map(p=>{var nt,De,we,Fe,Pe,l,d;const C=Number(((nt=p.product)==null?void 0:nt.id)||((De=p.product)==null?void 0:De.goods_id)||((we=p.product)==null?void 0:we.goodsId)||((Fe=p.product)==null?void 0:Fe.gid)||((Pe=p.product)==null?void 0:Pe.ID)||((l=p.product)==null?void 0:l.Id)||((d=p.product)==null?void 0:d.id)),y=Number(p.totalQtySmallUnits||p.smallQty||0),H=Number(p.amount||0),te=p.itemRemark||"",E=Number(p.f_stock||0),pe=p.basketId?Number(p.basketId):void 0,ke=p.basketQty?Number(p.basketQty):void 0,ae=p.saleTypeId?Number(p.saleTypeId):void 0,ot=(p.warehouseDetails||[]).map(V=>({warehouse_id:V.warehouse_id,quantity:V.qty}));return{goods_id:C,num:y,price:H,mark:te,f_stock:E,deposit_id:pe,deposit_num:ke,sale_id:ae,warehouse_distribution:ot}}).filter(p=>p.goods_id&&p.num>0),o=le.value.map(p=>({price:Number(p.amount||0),bear:p.bearer==="自己承担"?1:2,other_unit_id:Number(p.item||0)})).filter(p=>p.price>0&&p.other_unit_id),f=le.value.map(p=>Number(p.item||0)).filter(p=>p>0).join(","),g={customer_id:s.supplier,staff_id:s.handler,warehouse_id:s.warehouse,order_sn:s.documentNumber,time:t(s.businessDate),describe:s.remark,file:(s.images||[]).join(","),money:Number(s.roundingAmount||0),order_price:Number(s.payableTotal||0),goods:e,costs:o,otherUnit_ids:f},h=await J.orderEdit(X.value,g);(h==null?void 0:h.code)===1e4&&(oe.success("编辑成功"),be.back())}catch(t){console.error("编辑销售单失败:",t),oe.error("编辑销售单失败")}},xt=()=>{be.back()},$=()=>{const t=parseFloat(s.purchaseTotal)||0,e=parseFloat(s.expenseTotal)||0,o=parseFloat(s.depositTotal)||0,f=parseFloat(s.roundingAmount)||0;s.payableTotal=(t+e+o-f).toFixed(2)};ye(Ye,t=>{s.purchaseTotal=Number(t).toFixed(2),$()},{immediate:!0}),ye(U,()=>{pt(),$()},{deep:!0}),ye(()=>s.depositTotal,()=>{$()}),ye(()=>s.roundingAmount,()=>{$()}),ye(()=>s.expenseTotal,()=>{$()});const fe=k(!1),qt=k(!1),Je=k([]),At=()=>{fe.value=!0},Ht=async t=>{const e=t.reduce((f,g)=>{const h=Me.value.find(p=>p.id===g.id);return f+(h?h.price*Number(g.number):0)},0);s.depositTotal=e.toFixed(2),Je.value=t;const o=M.value?X.value:K.value;Je.value.length>0&&await Wt(o||null)},Wt=async t=>{try{if(!s.supplier||Je.value.length===0)return;const e={customer_id:String(s.supplier),deposits:Je.value.map(f=>({id:String(f.id),number:String(f.number)}))};t&&(e.order_id=String(t));const o=await J.addDeposit(e);(o==null?void 0:o.code)===1e4||o!=null&&o.success?(oe.success("收筐提交成功"),Je.value=[]):oe.error((o==null?void 0:o.msg)||"收筐提交失败")}catch{oe.error("收筐提交失败")}},jt=()=>{for(let t=0;t<4;t++)U.value.push({product:{id:null},amount:0,smallQty:0,largeQty:0,quantityText:"",totalQtySmallUnits:0})},Kt=t=>{if(t.product.id!==null)return!1;const e=U.value.findIndex(o=>o.product.id===null);return e!==-1&&U.value[e]===t};Ct(async()=>{const t=B.query.id;t?(M.value=!0,X.value=t):ft(),await Promise.all([R(),Y(),O(),Oe(),mt()]),M.value&&X.value?(await z(X.value),console.log()):jt()});const Ae=k(!1),Nt=k(null),Xe=k([]),Pt=k(!1),St=k(!1),It=ce(()=>{const t=G.value.find(e=>e.id===s.supplier);return t?t.name:s.supplier||"—"}),Qt=()=>{s.supplier&&(St.value=!0)},Ot=t=>{console.log("查看销售详情:",t)},Gt=(t,e)=>{var o;console.log(t),((o=t.product)==null?void 0:o.id)!=null&&(Ze.value=e,console.log(t.smallQty),Ne.value=t.smallQty,console.log(Ne.value),st(()=>{const f=document.getElementById(`quantity-input-${e}`);f==null||f.focus()}))},zt=t=>{var H,te,E,pe,ke;if(!Ne.value||Ne.value===""){Ze.value=-1;return}const e=U.value[t],o=((te=(H=e.product)==null?void 0:H.unit)==null?void 0:te.name)||"瓶",f=parseFloat(Ne.value);if(isNaN(f)||f<=0){oe.error("请输入有效的数量"),Ze.value=-1;return}e.quantityText=`${f}${o}`,e.smallQty=f;const g=Number(e.smallPrice??((E=e.product)==null?void 0:E.price)??0),h=Number(e.largePrice??((pe=e.product)==null?void 0:pe.b_price)??0),p=Number(e.smallQty),C=Number(e.largeQty||0);let y=+(p*g+C*h).toFixed(2);Number(e.saleTypeId)===2&&(y=-Math.abs(y)),e.amount=y,e.largeQty&&((ke=e.product)!=null&&ke.b_ratio)?e.totalQtySmallUnits=e.largeQty*e.product.b_ratio+f:e.totalQtySmallUnits=f,Ze.value=-1,Ne.value=""},Yt=(t,e)=>{var o;((o=t.product)==null?void 0:o.id)!=null&&(et.value=e,qe.value=String(t.unitPrice??t.price??t.product.price??0),st(()=>{const f=document.getElementById(`small-price-input-${e}`);f==null||f.focus()}))},Dt=t=>{var y;if(!qe.value||qe.value===""){et.value=-1;return}const e=U.value[t],o=parseFloat(qe.value);if(isNaN(o)||o<0){oe.error("请输入有效的单价"),et.value=-1;return}e.unitPrice=o,e.smallPrice=o;const f=Number(e.smallPrice),g=Number(e.largePrice??((y=e.product)==null?void 0:y.b_price)??0),h=Number(e.smallQty||0),p=Number(e.largeQty||0);let C=+(h*f+p*g).toFixed(2);Number(e.saleTypeId)===2&&(C=-Math.abs(C)),e.amount=C,et.value=-1,qe.value=""},Jt=(t,e)=>{var o,f;((o=t.product)==null?void 0:o.id)==null||!((f=t.product)!=null&&f.f_unit)||(tt.value=e,Ie.value=String(t.f_stock??0),st(()=>{const g=document.getElementById(`f-stock-input-${e}`);g==null||g.focus()}))},Ft=t=>{if(!Ie.value||Ie.value===""){tt.value=-1;return}const e=U.value[t],o=parseFloat(Ie.value);if(isNaN(o)||o<0){oe.error("请输入有效的副单位数量"),tt.value=-1;return}e.f_stock=o,tt.value=-1,Ie.value=""},Xt=(t,e)=>{var o;((o=t.product)==null?void 0:o.id)==null||!t.largePrice||(lt.value=e,Qe.value=String(t.largeQty??0),st(()=>{const f=document.getElementById(`large-qty-input-${e}`);f==null||f.focus()}))},Bt=t=>{var y,H,te;if(!Qe.value||Qe.value===""){lt.value=-1;return}const e=U.value[t],o=parseFloat(Qe.value);if(isNaN(o)||o<=0){oe.error("请输入有效的数量"),lt.value=-1;return}e.largeQty=o,e.smallQty&&((y=e.product)!=null&&y.b_ratio)?e.totalQtySmallUnits=o*e.product.b_ratio+e.smallQty:(H=e.product)!=null&&H.b_ratio&&(e.totalQtySmallUnits=o*e.product.b_ratio);const f=Number(e.smallPrice??((te=e.product)==null?void 0:te.price)??0),g=Number(e.largePrice),h=Number(e.smallQty||0),p=Number(e.largeQty);let C=+(h*f+p*g).toFixed(2);Number(e.saleTypeId)===2&&(C=-Math.abs(C)),e.amount=C,lt.value=-1,Qe.value=""},Zt=(t,e)=>{var o;((o=t.product)==null?void 0:o.id)==null||!t.largePrice||(at.value=e,ze.value=String(t.largePrice??0),st(()=>{const f=document.getElementById(`large-price-input-${e}`);f==null||f.focus()}))},Lt=t=>{var y;if(!ze.value||ze.value===""){at.value=-1;return}const e=U.value[t],o=parseFloat(ze.value);if(isNaN(o)||o<0){oe.error("请输入有效的单价"),at.value=-1;return}e.largePrice=o;const f=Number(e.smallPrice??((y=e.product)==null?void 0:y.price)??0),g=Number(e.largePrice),h=Number(e.smallQty||0),p=Number(e.largeQty||0);let C=+(h*f+p*g).toFixed(2);Number(e.saleTypeId)===2&&(C=-Math.abs(C)),e.amount=C,at.value=-1,ze.value=""},Ze=k(-1),Ne=k(""),et=k(-1),qe=k(""),tt=k(-1),Ie=k(""),lt=k(-1),Qe=k(""),at=k(-1),ze=k(""),re=Vt({loaded:!1,debt:0,days:0,unopened_days:0}),el=async t=>{try{re.loaded=!1;const e=await J.customerDebt(t);if(console.log(e),e&&(e.code===1e4||e.code===0||e.success)){const o=e.data||{};re.debt=Number(o.debt??0),re.days=Number(o.debt_days??0),re.unopened_days=Number(o.unopened_days??0)}}catch(e){console.error("获取客户欠款失败",e)}finally{re.loaded=!0}};return ye(()=>s.supplier,t=>{t?el(t):(re.loaded=!1,re.debt=0,re.days=0,re.unopened_days=0)}),(t,e)=>{var Pe;const o=Q("el-date-picker"),f=Q("el-option"),g=Q("el-select"),h=Q("el-button"),p=Q("el-input"),C=Q("MoreFilled"),y=Q("el-icon"),H=Q("CirclePlusFilled"),te=Q("RemoveFilled"),E=Q("el-table-column"),pe=Q("el-tag"),ke=Q("el-table"),ae=Q("el-col"),wt=Q("el-row"),ot=Q("el-upload"),nt=Q("el-image"),De=Q("el-dialog"),we=Q("el-form-item"),Fe=Q("el-form");return c(),w("div",fa,[i("div",null,[i("div",va,[i("div",ya,[i("div",ba,[i("div",_a,[i("div",ga,[e[30]||(e[30]=P(" 单据编号：")),i("text",ha,T(s.documentNumber),1)]),i("div",ka,[e[31]||(e[31]=P(" 日期： ")),u(o,{style:{border:"none"},size:N(F),modelValue:s.businessDate,"onUpdate:modelValue":e[0]||(e[0]=l=>s.businessDate=l),type:"date",placeholder:"请选择"},null,8,["size","modelValue"])]),i("div",xa,[e[32]||(e[32]=P(" 经手人：")),u(g,{size:N(F),modelValue:s.handler,"onUpdate:modelValue":e[1]||(e[1]=l=>s.handler=l),placeholder:"请选择",filterable:""},{default:r(()=>[(c(!0),w(ne,null,ve(x.value,l=>(c(),L(f,{size:N(F),key:l.id,label:l.name,value:l.id},null,8,["size","label","value"]))),128))]),_:1},8,["size","modelValue"])])]),i("div",wa,[u(h,{onClick:_e},{default:r(()=>e[33]||(e[33]=[P("刷新")])),_:1}),u(h,{onClick:m,type:"success"},{default:r(()=>e[34]||(e[34]=[P("新增商品")])),_:1}),u(h,{type:"primary"},{default:r(()=>e[35]||(e[35]=[P("新增客户")])),_:1}),u(h,{type:"primary",onClick:e[2]||(e[2]=l=>se.value=!0)},{default:r(()=>e[36]||(e[36]=[P("附件")])),_:1}),u(h,{onClick:_t,type:"danger"},{default:r(()=>e[37]||(e[37]=[P("取消")])),_:1}),u(h,{type:"primary",onClick:gt},{default:r(()=>[P(T(M.value?"保存":"确认"),1)]),_:1})])])]),i("div",Va,[i("div",$a,[i("div",Na,[i("div",Pa,[i("div",Sa,[e[38]||(e[38]=i("div",{class:"lable"},"仓库",-1)),u(g,{modelValue:s.warehouse,"onUpdate:modelValue":e[3]||(e[3]=l=>s.warehouse=l),placeholder:"请选择",filterable:""},{default:r(()=>[(c(!0),w(ne,null,ve(Z.value,l=>(c(),L(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i("div",Ta,[i("div",Ca,[e[40]||(e[40]=i("div",{class:"lable"},"买家",-1)),i("div",Ua,[u(g,{modelValue:s.supplier,"onUpdate:modelValue":e[4]||(e[4]=l=>s.supplier=l),placeholder:"请选择",filterable:"",onChange:ie},{default:r(()=>[(c(!0),w(ne,null,ve(G.value,l=>(c(),L(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(h,{type:"primary",onClick:Qt,disabled:!s.supplier},{default:r(()=>e[39]||(e[39]=[P("销售历史")])),_:1},8,["disabled"]),s.supplier&&re.loaded?(c(),w("div",qa," 当前欠款:"+T(re.debt)+"元 欠款天数:"+T(re.days)+"天 未开单天数:"+T(re.unopened_days)+"天 ",1)):W("",!0)])])])]),i("div",Ia,[u(h,null,{default:r(()=>e[41]||(e[41]=[P("保存")])),_:1}),u(h,{type:"success"},{default:r(()=>e[42]||(e[42]=[P("审核")])),_:1})])])]),i("div",Qa,[i("div",za,[i("div",Da,[e[43]||(e[43]=i("div",{class:"lable"},"买家电话",-1)),u(p,{disabled:!s.supplier,modelValue:s.phone,"onUpdate:modelValue":e[5]||(e[5]=l=>s.phone=l),placeholder:"买家电话"},null,8,["disabled","modelValue"])]),i("div",Fa,[e[44]||(e[44]=i("div",{class:"lable"},"送货地址",-1)),u(p,{disabled:!s.supplier,modelValue:s.address,"onUpdate:modelValue":e[6]||(e[6]=l=>s.address=l),placeholder:"送货地址"},null,8,["disabled","modelValue"])])])]),i("div",Ba,[i("div",La,[e[45]||(e[45]=i("div",{class:"lable"},"单据备注",-1)),u(p,{style:{width:"500px"},modelValue:s.remark,"onUpdate:modelValue":e[7]||(e[7]=l=>s.remark=l),placeholder:"单据备注"},null,8,["modelValue"])])])])]),i("div",Ea,[i("div",Ra,[i("div",Ma,[u(h,{type:"primary",disabled:!s.warehouse,onClick:b},{default:r(()=>e[46]||(e[46]=[P("添加商品")])),_:1},8,["disabled"]),u(h,{class:"ml10",disabled:!s.supplier,onClick:At},{default:r(()=>e[47]||(e[47]=[P("收筐")])),_:1},8,["disabled"])]),u(ke,{data:U.value,border:"",stripe:"","show-summary":"","summary-method":ut,style:{"table-layout":"auto"},"header-cell-style":N(ol)},{default:r(()=>[u(E,{fixed:"left",type:"index",label:"序号",align:"center",width:"80"},{header:r(()=>[i("div",{style:{cursor:"pointer",color:"red"},onClick:rt},[u(y,null,{default:r(()=>[u(C,{size:30})]),_:1})])]),default:r(l=>[i("div",{class:"index-cell",onMouseenter:d=>j.value=l.$index,onMouseleave:e[8]||(e[8]=d=>j.value=-1)},[j.value!==l.$index?(c(),w("span",Ha,T(l.$index+1),1)):(c(),w("div",Wa,[u(y,{size:22,style:{cursor:"pointer",color:"green"},onClick:Tt(d=>bt(l.$index),["stop"])},{default:r(()=>[u(H)]),_:2},1032,["onClick"]),u(y,{size:22,style:{cursor:"pointer",color:"red"},onClick:Tt(d=>yt(l.$index),["stop"])},{default:r(()=>[u(te)]),_:2},1032,["onClick"])]))],40,Aa)]),_:1}),(c(!0),w(ne,null,ve(ct.value,l=>(c(),w(ne,{key:l.id},[l.name==="商品名字"?(c(),L(E,{key:0,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,"min-width":"200"},{default:r(d=>[d.row.product.name?(c(),w("span",ja,T(d.row.product.name),1)):Kt(d.row)?(c(),w("span",{key:1,class:"clickable-text",onClick:b},T("添加商品"))):W("",!0),d.row.product.is_quan?(c(),L(pe,{key:2,size:N(F),type:"primary",class:"ml5"},{default:r(()=>e[48]||(e[48]=[P("定")])),_:1},8,["size"])):W("",!0)]),_:2},1032,["align","fixed","label"])):W("",!0),l.name==="条形码"?(c(),L(E,{key:1,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"product.unit_barcode",label:l.showName,width:"200"},{default:r(d=>[i("span",null,T(d.row.product.unit_barcode||""),1)]),_:2},1032,["align","fixed","label"])):l.name==="规格"?(c(),L(E,{key:2,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"saleTypeName",label:l.showName,width:"120"},{default:r(d=>{var V;return[i("span",null,T((V=d.row.product.spec)==null?void 0:V.name),1)]}),_:2},1032,["align","fixed","label"])):l.name==="销售类型"?(c(),L(E,{key:3,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"saleTypeName",label:l.showName,"min-width":"100"},{default:r(d=>[i("span",null,T(d.row.saleTypeName),1)]),_:2},1032,["align","fixed","label"])):l.name==="单位"?(c(),L(E,{key:4,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"product.unit",label:l.showName,"min-width":"90"},{default:r(d=>{var V,A;return[i("div",null,[i("span",null,T((A=(V=d.row.product)==null?void 0:V.unit)==null?void 0:A.name),1)])]}),_:2},1032,["align","fixed","label"])):l.name==="数量"?(c(),L(E,{key:5,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,"min-width":"100"},{default:r(d=>{var V;return[Ze.value===d.$index?(c(),w("div",Ka,[u(p,{size:N(F),modelValue:Ne.value,"onUpdate:modelValue":e[9]||(e[9]=A=>Ne.value=A),onBlur:A=>zt(d.$index),onKeyup:He(A=>zt(d.$index),["enter"]),type:"number",id:`quantity-input-${d.$index}`,placeholder:"请输入数量"},null,8,["size","modelValue","onBlur","onKeyup","id"])])):(c(),w("div",{key:1,onClick:A=>Gt(d.row,d.$index)},[((V=d.row.product)==null?void 0:V.id)!==null&&d.row.smallQty!==0?(c(),w("span",Ga,T(d.row.smallQty),1)):W("",!0)],8,Oa))]}),_:2},1032,["align","fixed","label"])):l.name==="单价(小单位)"?(c(),L(E,{key:6,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,width:"120"},{default:r(d=>{var V;return[et.value===d.$index?(c(),w("div",Ya,[u(p,{size:N(F),modelValue:qe.value,"onUpdate:modelValue":e[10]||(e[10]=A=>qe.value=A),onBlur:A=>Dt(d.$index),onKeyup:He(A=>Dt(d.$index),["enter"]),type:"number",id:`small-price-input-${d.$index}`,placeholder:"请输入单价"},null,8,["size","modelValue","onBlur","onKeyup","id"])])):(c(),w("div",{key:1,onClick:A=>Yt(d.row,d.$index)},[((V=d.row.product)==null?void 0:V.id)!==null&&(d.row.unitPrice!=="0.00"||d.row.price!=="0.00"||d.row.product.price!==0)?(c(),w("span",Xa,T((Number(d.row.unitPrice??d.row.price??d.row.product.price??0)||0).toFixed(2)+"元"),1)):W("",!0)],8,Ja))]}),_:2},1032,["align","fixed","label"])):l.name==="副单位"?(c(),L(E,{key:7,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,width:"120"},{default:r(d=>{var V;return[tt.value===d.$index?(c(),w("div",Za,[u(p,{size:N(F),modelValue:Ie.value,"onUpdate:modelValue":e[11]||(e[11]=A=>Ie.value=A),onBlur:A=>Ft(d.$index),onKeyup:He(A=>Ft(d.$index),["enter"]),type:"number",id:`f-stock-input-${d.$index}`,placeholder:"请输入副单位数量"},null,8,["size","modelValue","onBlur","onKeyup","id"])])):(c(),w("div",{key:1,class:"quantity-cell",onClick:A=>Jt(d.row,d.$index)},[d.row.f_stock&&((V=d.row.product)!=null&&V.f_unit)?(c(),w("span",to,T(d.row.f_stock)+T(d.row.product.f_unit),1)):W("",!0)],8,eo))]}),_:2},1032,["align","fixed","label"])):l.name==="单位（大）"?(c(),L(E,{key:8,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"product.b_unit",label:l.showName,width:"120"},{default:r(d=>{var V,A;return[i("div",lo,[i("span",null,T((A=(V=d.row.product)==null?void 0:V.b_unit)==null?void 0:A.name),1)])]}),_:2},1032,["align","fixed","label"])):l.name==="数量（大单位）"?(c(),L(E,{key:9,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"largeQty",label:l.showName,"min-width":"140"},{default:r(d=>[lt.value===d.$index?(c(),w("div",ao,[u(p,{size:N(F),modelValue:Qe.value,"onUpdate:modelValue":e[12]||(e[12]=V=>Qe.value=V),onBlur:V=>Bt(d.$index),onKeyup:He(V=>Bt(d.$index),["enter"]),type:"number",id:`large-qty-input-${d.$index}`,placeholder:"请输入数量"},null,8,["size","modelValue","onBlur","onKeyup","id"])])):(c(),w("div",{key:1,class:"quantity-cell",onClick:V=>Xt(d.row,d.$index)},[d.row.largeQty?(c(),w("span",no,T(d.row.largeQty),1)):W("",!0)],8,oo))]),_:2},1032,["align","fixed","label"])):l.name==="单价(大单位)"?(c(),L(E,{key:10,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,width:"120"},{default:r(d=>[at.value===d.$index?(c(),w("div",so,[u(p,{size:N(F),modelValue:ze.value,"onUpdate:modelValue":e[13]||(e[13]=V=>ze.value=V),type:"number",onBlur:V=>Lt(d.$index),onKeyup:He(V=>Lt(d.$index),["enter"]),id:`large-price-input-${d.$index}`,placeholder:"请输入单价"},null,8,["size","modelValue","onBlur","onKeyup","id"])])):(c(),w("div",{key:1,class:"quantity-cell",onClick:V=>Zt(d.row,d.$index)},[d.row.largePrice?(c(),w("span",uo,T(Number(d.row.largePrice)+"元"),1)):W("",!0)],8,io))]),_:2},1032,["align","fixed","label"])):l.name==="金额(元)"?(c(),L(E,{key:11,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,"min-width":"120"},{default:r(d=>{var V;return[((V=d.row.product)==null?void 0:V.id)!==null&&Number(d.row.amount)!==0?(c(),w("span",ro,T(Number(d.row.amount).toFixed(2)),1)):W("",!0)]}),_:2},1032,["align","fixed","label"])):l.name==="库存"?(c(),L(E,{key:12,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),label:l.showName,width:"220"},{default:r(d=>{var V;return[d.row.stockText||d.row.product.stock?(c(),w("span",co,T(d.row.stockText||`${d.row.product.stock}${(V=d.row.product.unit)==null?void 0:V.name}`),1)):W("",!0)]}),_:2},1032,["align","fixed","label"])):l.name==="单品备注"?(c(),L(E,{key:13,align:l.align==="default"?"":l.align,fixed:N(de)(l.flex),prop:"itemRemark",label:l.showName,"min-width":"200"},{default:r(d=>{var V;return[((V=d.row.product)==null?void 0:V.id)!==null?(c(),L(p,{key:0,size:N(F),modelValue:d.row.itemRemark,"onUpdate:modelValue":A=>d.row.itemRemark=A,placeholder:"可输入备注信息"},null,8,["size","modelValue","onUpdate:modelValue"])):W("",!0)]}),_:2},1032,["align","fixed","label"])):W("",!0)],64))),128))]),_:1},8,["data","header-cell-style"]),u(nl,{modelValue:Ce.value,"onUpdate:modelValue":e[14]||(e[14]=l=>Ce.value=l),"header-title":Ue,onSave:dt},null,8,["modelValue","header-title"])])]),i("div",mo,[i("div",po,[u(wt,{gutter:24},{default:r(()=>[u(ae,{span:4},{default:r(()=>[i("div",fo,[e[49]||(e[49]=i("label",null,"销售合计",-1)),u(p,{size:N(F),modelValue:s.purchaseTotal,"onUpdate:modelValue":e[15]||(e[15]=l=>s.purchaseTotal=l),readonly:""},null,8,["size","modelValue"])])]),_:1}),u(ae,{span:8},{default:r(()=>[i("div",vo,[e[52]||(e[52]=i("label",null,"费用合计",-1)),i("div",yo,[u(p,{size:N(F),modelValue:s.expenseTotal,"onUpdate:modelValue":e[16]||(e[16]=l=>s.expenseTotal=l),placeholder:"自动汇总",readonly:""},{append:r(()=>e[50]||(e[50]=[P("元")])),_:1},8,["size","modelValue"]),u(h,{size:N(F),class:"ml10",onClick:We},{default:r(()=>e[51]||(e[51]=[P("添加")])),_:1},8,["size"])])])]),_:1}),u(ae,{span:4},{default:r(()=>[i("div",bo,[e[54]||(e[54]=i("label",null,"押筐合计",-1)),u(p,{size:N(F),modelValue:s.depositTotal,"onUpdate:modelValue":e[17]||(e[17]=l=>s.depositTotal=l),placeholder:"自动汇总",readonly:""},{append:r(()=>e[53]||(e[53]=[P("元")])),_:1},8,["size","modelValue"])])]),_:1}),u(ae,{span:4},{default:r(()=>[i("div",_o,[e[56]||(e[56]=i("label",null,"抹零金额",-1)),u(p,{size:N(F),modelValue:s.roundingAmount,"onUpdate:modelValue":e[18]||(e[18]=l=>s.roundingAmount=l),placeholder:"请输入"},{append:r(()=>e[55]||(e[55]=[P("元")])),_:1},8,["size","modelValue"])])]),_:1}),u(ae,{span:4},{default:r(()=>[i("div",go,[e[57]||(e[57]=i("label",null,"应收合计",-1)),u(p,{size:N(F),modelValue:s.payableTotal,"onUpdate:modelValue":e[19]||(e[19]=l=>s.payableTotal=l),readonly:"",class:"payable-input"},null,8,["size","modelValue"])])]),_:1})]),_:1}),i("div",ho,[u(ae,{span:6},{default:r(()=>[i("span",ko,"总计额: "+T(Ye.value),1)]),_:1}),u(ae,{span:6},{default:r(()=>e[58]||(e[58]=[i("span",{class:"total-amount"},"应收额:0",-1)])),_:1}),u(ae,{span:12},{default:r(()=>e[59]||(e[59]=[i("div",{class:"summary—_right"},[i("span",{class:"org-amount"},"本单欠: 0"),i("span",{class:"org-amount"},"累欠: 0"),i("span",{class:"org-amount"},"总累欠: 0")],-1)])),_:1})])])]),u(De,{modelValue:se.value,"onUpdate:modelValue":e[20]||(e[20]=l=>se.value=l),title:"上传附件",width:"400px",center:""},{default:r(()=>[i("div",xo,[u(ot,{size:N(F),class:"upload-demo",drag:"",headers:{Authorization:`Bearer ${N(sl)().token}`},name:"image","show-file-list":!1,"on-success":vt,action:"https://software.syn.tswm.club/api/upload/image",multiple:""},{default:r(()=>[u(y,{class:"el-icon--upload"},{default:r(()=>[u(N(il))]),_:1}),e[60]||(e[60]=i("div",{class:"el-upload__text"}," 上传图片 ",-1))]),_:1},8,["size","headers"]),(c(!0),w(ne,null,ve(s.images,l=>(c(),w("div",{key:l,class:"image-item"},[u(nt,{src:l},null,8,["src"])]))),128))])]),_:1},8,["modelValue"])]),u(ul,{ref_key:"drawerProductSelectorRef",ref:a,modelValue:n.value,"onUpdate:modelValue":e[21]||(e[21]=l=>n.value=l),"selected-products":ue.value,"warehouse-id":s.warehouse,onConfirm:Te,onSelect:S,onUnselect:D},null,8,["modelValue","selected-products","warehouse-id"]),u(pa,{ref_key:"productSelectorRef",ref:_,modelValue:v.value,"onUpdate:modelValue":e[22]||(e[22]=l=>v.value=l),"selected-products":ue.value,"warehouse-id":s.warehouse,onConfirm:Te,onSelect:ee,onUnselect:D},null,8,["modelValue","selected-products","warehouse-id"]),u(Wl,{modelValue:Ae.value,"onUpdate:modelValue":e[23]||(e[23]=l=>Ae.value=l),product:Nt.value,onConfirm:he,onHistory:xe,onCancel:Le,onViewHistoryPrice:it},null,8,["modelValue","product"]),u(dl,{modelValue:Pt.value,"onUpdate:modelValue":e[24]||(e[24]=l=>Pt.value=l),"customer-name":It.value,payable:s.payableTotal,"customer-id":s.supplier,"order-id":K.value||"",onSave:xt},null,8,["modelValue","customer-name","payable","customer-id","order-id"]),u(cl,{modelValue:fe.value,"onUpdate:modelValue":e[25]||(e[25]=l=>fe.value=l),"customer-id":s.supplier,"deposit-list":Me.value,onSave:Ht},null,8,["modelValue","customer-id","deposit-list"]),u(De,{size:N(F),modelValue:ge.value,"onUpdate:modelValue":e[26]||(e[26]=l=>ge.value=l),title:"费用明细",width:"1000px","append-to-body":""},{footer:r(()=>[u(h,{size:N(F),onClick:je},{default:r(()=>e[63]||(e[63]=[P("添加")])),_:1},8,["size"]),u(h,{size:N(F),type:"primary",onClick:Ke},{default:r(()=>e[64]||(e[64]=[P("保存")])),_:1},8,["size"])]),default:r(()=>[u(Fe,{size:N(F),"label-width":"80px"},{default:r(()=>[(c(!0),w(ne,null,ve(le.value,(l,d)=>(c(),w("div",{key:d,class:"expense-row"},[u(we,{size:N(F),label:"费用项"},{default:r(()=>[u(g,{size:N(F),modelValue:l.item,"onUpdate:modelValue":V=>l.item=V,placeholder:"请选择",style:{width:"160px"}},{default:r(()=>[(c(!0),w(ne,null,ve(Se.value,V=>(c(),L(f,{size:N(F),key:V.value,label:V.label,value:V.value},null,8,["size","label","value"]))),128))]),_:2},1032,["size","modelValue","onUpdate:modelValue"])]),_:2},1032,["size"]),u(we,{size:N(F),label:"费用金额"},{default:r(()=>[u(p,{size:N(F),modelValue:l.amount,"onUpdate:modelValue":V=>l.amount=V,placeholder:"请输入",style:{width:"180px"}},{append:r(()=>e[61]||(e[61]=[P("元")])),_:2},1032,["size","modelValue","onUpdate:modelValue"])]),_:2},1032,["size"]),u(we,{size:N(F),label:"费用承担"},{default:r(()=>[u(g,{size:N(F),modelValue:l.bearer,"onUpdate:modelValue":V=>l.bearer=V,placeholder:"请选择",style:{width:"160px"}},{default:r(()=>[u(f,{size:N(F),label:"自己承担",value:"自己承担"},null,8,["size"]),u(f,{size:N(F),label:"对方承担",value:"对方承担"},null,8,["size"])]),_:2},1032,["size","modelValue","onUpdate:modelValue"])]),_:2},1032,["size"]),le.value.length>1?(c(),L(h,{key:0,size:N(F),link:"",type:"primary",onClick:V=>Ve(d)},{default:r(()=>e[62]||(e[62]=[P("删除")])),_:2},1032,["size","onClick"])):W("",!0)]))),128))]),_:1},8,["size"])]),_:1},8,["size","modelValue"]),u(ml,{modelValue:St.value,"onUpdate:modelValue":e[27]||(e[27]=l=>St.value=l),"customer-id":s.supplier,"customer-info":{name:It.value,phone:((Pe=G.value.find(l=>l.id===s.supplier))==null?void 0:Pe.phone)||"",debt:re.debt},onViewDetail:Ot},null,8,["modelValue","customer-id","customer-info"]),u(pl,{modelValue:qt.value,"onUpdate:modelValue":e[28]||(e[28]=l=>qt.value=l),"customer-id":s.supplier},null,8,["modelValue","customer-id"]),u(rl,{modelValue:Ee.value,"onUpdate:modelValue":e[29]||(e[29]=l=>Ee.value=l),data:Ge.value},null,8,["modelValue","data"])])}}}),So=Ut(wo,[["__scopeId","data-v-1d7a3ec8"]]);export{So as default};
