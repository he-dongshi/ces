import{d as F,u as M,G as T,r as I,m as $,o as q,a as u,c as g,b as p,g as s,h as d,e as n,F as V,i as S,j as k,k as D,A as _,E as f,_ as A}from"./index-BUVdxLJQ.js";const O={class:"page p20"},P={class:"section mb20"},R={class:"section-content"},j={class:"form-item"},G={class:"form-item"},J={class:"form-item"},W={class:"form-item"},Y={class:"action-buttons"},z=F({__name:"createInventory",setup(H){const w=M(),L=T(),b=I([]),h=I([]),o=$({id:"",sn:"",warehouseId:"",method:"all",handlerId:""}),N=async()=>{try{const a=await _.getOrderSn();if((a==null?void 0:a.code)===1e4&&(a!=null&&a.data)){o.sn=a.data;return}}catch{}o.sn="PD"+new Date().getTime()},x=async()=>{try{const a=await _.warehouseList({page:1,limit:99999});a.code===1e4&&(b.value=a.data||[])}catch(a){console.error("获取仓库列表失败:",a)}},B=async()=>{try{const a=await _.staffList({page:1,limit:99999});a.code===1e4&&(h.value=a.data||[])}catch(a){console.error("获取员工列表失败:",a)}};async function C(){var i,m;if(!o.warehouseId){f.error("请选择盘点仓库");return}if(!o.handlerId){f.error("请选择经手人");return}const a=t=>{const r=t?new Date(t):new Date;if(Number.isNaN(r.getTime()))return"";const y=r.getFullYear(),l=String(r.getMonth()+1).padStart(2,"0"),E=String(r.getDate()).padStart(2,"0");return`${y}-${l}-${E}`},e=String(L.query.pid||"0"),v=o.method==="all"?"1":"2",c={warehouse_id:String(o.warehouseId||""),user_id:String(o.handlerId||""),created_at:a(new Date),pid:e,type:v,cate_ids:""};try{const t=await _.add("inventory_plan",c);if(t&&(t.code===1e4||t.success)){const r=String(((i=t==null?void 0:t.data)==null?void 0:i.id)||((m=t==null?void 0:t.data)==null?void 0:m.plan_id)||(t==null?void 0:t.id));if(r){w.replace({name:"inventoryJoin",query:{id:r}});return}}f.error((t==null?void 0:t.msg)||(t==null?void 0:t.message)||"创建盘点单失败")}catch{f.error("创建盘点单失败")}}function U(){w.back()}return q(async()=>{await Promise.all([N(),x(),B()])}),(a,e)=>{const v=u("el-input"),c=u("el-col"),i=u("el-option"),m=u("el-select"),t=u("el-row"),r=u("el-button"),y=u("el-card");return p(),g("div",O,[s(y,{shadow:"never"},{default:d(()=>[e[11]||(e[11]=n("div",{class:"page-header"},[n("h2",null,"新建盘点单")],-1)),n("div",P,[e[8]||(e[8]=n("div",{class:"section-title"},[n("span",null,"盘点信息")],-1)),n("div",R,[s(t,{gutter:20},{default:d(()=>[s(c,{span:6},{default:d(()=>[n("div",j,[e[4]||(e[4]=n("label",null,"单据编号",-1)),s(v,{modelValue:o.sn,"onUpdate:modelValue":e[0]||(e[0]=l=>o.sn=l),readonly:""},null,8,["modelValue"])])]),_:1}),s(c,{span:6},{default:d(()=>[n("div",G,[e[5]||(e[5]=n("label",null,"盘点仓库",-1)),s(m,{modelValue:o.warehouseId,"onUpdate:modelValue":e[1]||(e[1]=l=>o.warehouseId=l),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:d(()=>[(p(!0),g(V,null,S(b.value,l=>(p(),k(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),s(c,{span:6},{default:d(()=>[n("div",J,[e[6]||(e[6]=n("label",null,"盘点方式",-1)),s(m,{modelValue:o.method,"onUpdate:modelValue":e[2]||(e[2]=l=>o.method=l),placeholder:"请选择",style:{width:"100%"}},{default:d(()=>[s(i,{label:"全量盘点",value:"all"}),s(i,{label:"分类盘点",value:"cate"})]),_:1},8,["modelValue"])])]),_:1}),s(c,{span:6},{default:d(()=>[n("div",W,[e[7]||(e[7]=n("label",null,"经手人",-1)),s(m,{modelValue:o.handlerId,"onUpdate:modelValue":e[3]||(e[3]=l=>o.handlerId=l),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:d(()=>[(p(!0),g(V,null,S(h.value,l=>(p(),k(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1})])]),n("div",Y,[s(r,{onClick:U},{default:d(()=>e[9]||(e[9]=[D("取消")])),_:1}),s(r,{type:"primary",disabled:!o.warehouseId||!o.handlerId,onClick:C},{default:d(()=>e[10]||(e[10]=[D("开始盘点")])),_:1},8,["disabled"])])]),_:1})])}}}),Q=A(z,[["__scopeId","data-v-02804f76"]]);export{Q as default};
