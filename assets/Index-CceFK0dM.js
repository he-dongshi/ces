import{d as $e,u as Re,r as h,m as re,l as Te,o as Ie,U as Be,a as g,z as Ee,c as F,b as _,e as s,g as l,h as n,D as G,k as b,p as qe,F as U,i as L,j as y,B as Ae,s as ie,V as Ge,W as Le,t as v,T as ze,A as C,y as je,E as ue,X as Oe,_ as Qe}from"./index-BUVdxLJQ.js";import{P as We,S as Xe}from"./SupplierHistoryDialog-BHcPeZEv.js";import{P as z}from"./PrintComponent-DWF2ajXU.js";import"./printProvider-D1gq-grw.js";const Je={class:"page p10"},Ke={class:"left-actions"},Ze={key:0},et={class:"page p10"},tt={class:"actions"},at={class:"left-actions"},lt={style:{display:"flex","align-items":"center"}},nt={style:{display:"inline-flex","margin-right":"10px"}},st={style:{display:"inline-flex","margin-right":"10px"}},ot={style:{display:"inline-flex","margin-right":"10px"}},rt={style:{color:"blue"}},it={style:{color:"red"}},ut={class:"drawer-container"},dt={class:"drawer-header"},pt={class:"drawer-btns"},mt={class:"basic-info"},ct={class:"info-item"},ft={class:"info-item"},_t={class:"info-item"},vt={class:"bill-content"},ht={class:"bill-item"},gt={class:"bill-item"},bt={class:"bill-item"},wt={style:{color:"#F79B2C"}},yt={class:"bill-item"},xt={style:{color:"#D43030"}},Vt={class:"goods-content"},kt={class:"repayment-record"},Dt=$e({__name:"Index",setup(Ct){const j=Re(),de=[{text:"昨天",value:()=>{const t=new Date;t.setDate(t.getDate()-1),t.setHours(0,0,0,0);const e=new Date(t);return e.setHours(23,59,59,999),[t,e]}},{text:"今天",value:()=>{const t=new Date;t.setHours(0,0,0,0);const e=new Date;return e.setHours(23,59,59,999),[t,e]}},{text:"本月",value:()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0);return i.setHours(23,59,59,999),[e,i]}},{text:"上月",value:()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth()-1,1),i=new Date(t.getFullYear(),t.getMonth(),0);return i.setHours(23,59,59,999),[e,i]}},{text:"本年",value:()=>{const t=new Date,e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),11,31);return i.setHours(23,59,59,999),[e,i]}},{text:"上年",value:()=>{const t=new Date,e=new Date(t.getFullYear()-1,0,1),i=new Date(t.getFullYear()-1,11,31);return i.setHours(23,59,59,999),[e,i]}}],H=h(!1),M=h(!1),Y=re([{id:"1",operate:"",name:"操作",showName:"操作",align:"default",column:!0,flex:"default"},{id:"2",operate:"",name:"采购编号",showName:"采购编号",align:"default",column:!0,flex:"default"},{id:"3",operate:"",name:"供应单位",showName:"供应单位",align:"default",column:!0,flex:"default"},{id:"4",operate:"",name:"金额(元)",showName:"金额(元)",align:"default",column:!0,flex:"default"},{id:"5",operate:"",name:"付款金额(元)",showName:"付款金额(元)",align:"default",column:!0,flex:"default"},{id:"6",operate:"",name:"应付金额(元)",showName:"应付金额(元)",align:"default",column:!0,flex:"default"},{id:"7",operate:"",name:"状态",showName:"状态",align:"default",column:!0,flex:"default"},{id:"8",operate:"",name:"制单时间",showName:"制单时间",align:"default",column:!0,flex:"default"}]);(async()=>{var e;const t=await C.goodsCateList({page:1,limit:9999});Q.value=Array.isArray(t.data)?t.data:((e=t.data)==null?void 0:e.data)||[]})();const O=h([]);(async()=>{try{const t=await C.staffList({page:1,limit:99999});t.code===1e4&&(O.value=t.data||[])}catch(t){console.error("获取员工列表失败:",t)}})();const pe=t=>{Y.splice(0,Y.length,...t),M.value=!1},me=()=>{console.log("表格列配置弹窗已关闭")},ce=()=>{M.value=!0},fe=t=>{const{columns:e,data:i}=t;let p=0,o=0,d=0;return i.forEach(c=>{p+=Number(c.all_price||0),o+=Number(c.pay_price||0),d+=Number(c.qian_price||0)}),e.map((c,x)=>c.type==="index"?"合计":c.type==="selection"?"":c.property==="all_price"?p.toFixed(2):c.property==="pay_price"?o.toFixed(2):c.property==="qian_price"?d.toFixed(2):"")},_e=Te(()=>Y.filter(t=>t.column===!0)),N=t=>t==="left"?"left":t==="center"?"right":!1,ve=t=>({采购编号:"order_sn",供应单位:"supplier.name",制单时间:"created_at"})[t]||"",he=t=>({采购编号:200,供应单位:140,制单时间:180})[t]||120,Q=h([]),u=re({page:1,limit:15,number:"",supplier_id:"",status:"",cateId:"",supplier:{}}),W=h(""),X=h(),k=h(!1),J=h([]),K=h(0),r=h({id:null,order_sn:"",supplier:null,staff:null,warehouse:null,created_at:"",status:0,order_price:0,pay_price:0,qian_price:0,all_price:0,purchaseGoods:[],purchasePay:[],payable:[]}),Z=h({}),$=h(!1),ge=h("rtl"),E=h(!1),R=h(!1),ee=()=>{D()},be=()=>{u.number="",u.supplier_id="",u.status="",u.cateId="",D()},we=()=>{j.push({path:"/purchase/list/createPurchase"})},ye=t=>{J.value=t},T=async t=>{try{k.value=!0;const i=(await C.purchaseDetail(t.id)).data||{},p=(i.purchaseGoods||[]).map(o=>{const d=Number((o==null?void 0:o.num)||0),w=Number((o==null?void 0:o.unit_price)||0),c=+(d*w).toFixed(2);return{...o,subtotal:c}});r.value={...i,purchaseGoods:p},Z.value={id:i.id,...r.value},$.value=!0}catch(e){console.error("获取详情失败:",e)}finally{k.value=!1}},q=async t=>{try{const i=(await C.purchaseDetail(t)).data||{},p=(i.purchaseGoods||[]).map(o=>{const d=Number((o==null?void 0:o.num)||0),w=Number((o==null?void 0:o.unit_price)||0),c=+(d*w).toFixed(2);return{...o,subtotal:c}});return{...i,purchaseGoods:p}}catch(e){throw console.error("获取采购详情失败:",e),e}},xe=t=>{j.push({path:"/purchase/list/createPurchase",query:{id:t.id}})},Ve=async()=>{try{await je.confirm("确定要反审核此采购单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0,await C.purchaseEnable(r.value.id),ue.success("反审核成功"),await T({id:r.value.id}),D()}catch(t){t!=="cancel"&&(console.error("反审核失败:",t),ue.error("反审核失败"))}finally{k.value=!1}},ke=()=>{E.value=!0},De=async()=>{var t;(t=r.value)!=null&&t.id&&(await T({id:r.value.id}),D())},Ce=()=>{R.value=!0},Ne=t=>{T(t),R.value=!1},D=()=>{k.value=!0,C.purchaseList(u).then(t=>{X.value=t.data,K.value=t.total,k.value=!1})},Se=()=>{const t=`采购单列表_${new Date().toISOString().split("T")[0]}.xlsx`;Oe(()=>C.exportPurchase(u),t)},Fe=()=>{$.value=!1};Ie(()=>{D()}),Be(()=>{D()});function Pe(t){var S,I,P;const e=[],i=Number(t.num||0),p=((S=t.unit)==null?void 0:S.name)||t.unit_name||"件";let o=i;const d=Number(t.c_ratio||0),w=Number(t.b_ratio||0),c=((I=t.c_unit)==null?void 0:I.name)||t.c_unit_name,x=((P=t.b_unit)==null?void 0:P.name)||t.b_unit_name;if(w>0&&o>=w&&x){const m=Math.floor(o/w);m>0&&(e.push(`${m}${x}`),o=o%w)}if(d>0&&o>=d&&c){const m=Math.floor(o/d);m>0&&(e.push(`${m}${c}`),o=o%d)}return o>0&&e.push(`${o}${p}`),e.length>0?e.join(" "):`0${p}`}return(t,e)=>{var te,ae,le,ne,se;const i=g("el-input"),p=g("el-form-item"),o=g("el-col"),d=g("el-button"),w=g("el-row"),c=g("el-date-picker"),x=g("el-option"),S=g("el-select"),I=g("el-form"),P=g("el-card"),m=g("el-table-column"),Ue=g("el-icon"),A=g("el-table"),He=g("el-pagination"),Me=g("el-drawer"),Ye=Ee("loading");return _(),F(U,null,[s("div",Je,[l(P,{shadow:"never"},{default:n(()=>[s("div",Ke,[l(I,{"label-position":"left",inline:!1,model:u},{default:n(()=>[l(w,{gutter:24},{default:n(()=>[l(o,{span:6},{default:n(()=>[l(p,{label:"商品名称：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.supplier.phone,"onUpdate:modelValue":e[0]||(e[0]=a=>u.supplier.phone=a),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"采购编号：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.number,"onUpdate:modelValue":e[1]||(e[1]=a=>u.number=a),placeholder:"请输入采购编号"},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"条形码：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.phone,"onUpdate:modelValue":e[2]||(e[2]=a=>u.phone=a),placeholder:"请输入条形码"},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{class:"goods-form-item"},{default:n(()=>[l(d,{type:"primary",onClick:ee},{default:n(()=>e[16]||(e[16]=[b("查询")])),_:1}),l(d,{onClick:be},{default:n(()=>e[17]||(e[17]=[b("重置")])),_:1}),l(d,{class:qe({topShow:H.value}),onClick:e[3]||(e[3]=a=>H.value=!H.value)},{default:n(()=>e[18]||(e[18]=[b(" 高级筛选 ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),H.value?(_(),F("div",Ze,[l(w,{gutter:24},{default:n(()=>[l(o,{span:12},{default:n(()=>[l(p,{label:"时间：",class:"goods-form-item"},{default:n(()=>[l(c,{modelValue:W.value,"onUpdate:modelValue":e[4]||(e[4]=a=>W.value=a),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss",shortcuts:de},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"手机号：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.supplier.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>u.supplier.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"分类：",class:"goods-form-item"},{default:n(()=>[l(S,{modelValue:u.cateId,"onUpdate:modelValue":e[6]||(e[6]=a=>u.cateId=a),placeholder:"请选择分类"},{default:n(()=>[(_(!0),F(U,null,L(Q.value,a=>(_(),y(x,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(w,{gutter:24},{default:n(()=>[l(o,{span:6},{default:n(()=>[l(p,{label:"品牌：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.supplier.brand,"onUpdate:modelValue":e[7]||(e[7]=a=>u.supplier.brand=a),placeholder:"请输入品牌"},null,8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"经手人：",class:"goods-form-item"},{default:n(()=>[l(S,{modelValue:u.supplier.handlerId,"onUpdate:modelValue":e[8]||(e[8]=a=>u.supplier.handlerId=a),placeholder:"请选择"},{default:n(()=>[(_(!0),F(U,null,L(O.value,a=>(_(),y(x,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"结账状态：",class:"goods-form-item"},{default:n(()=>[l(S,{modelValue:u.status,"onUpdate:modelValue":e[9]||(e[9]=a=>u.status=a),placeholder:"请选择结账状态",clearable:"",onChange:ee},{default:n(()=>[l(x,{label:"未审核",value:"0"}),l(x,{label:"待付款",value:"1"}),l(x,{label:"已还部分",value:"2"}),l(x,{label:"已结清",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(o,{span:6},{default:n(()=>[l(p,{label:"供应商：",class:"goods-form-item"},{default:n(()=>[l(i,{modelValue:u.supplier.name,"onUpdate:modelValue":e[10]||(e[10]=a=>u.supplier.name=a),placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])):G("",!0)]),_:1},8,["model"])])]),_:1})]),s("div",et,[l(P,{shadow:"never"},{default:n(()=>[s("div",tt,[s("div",at,[l(d,{type:"primary",onClick:we},{default:n(()=>e[19]||(e[19]=[b("新建采购单")])),_:1}),l(z,{"selected-data":J.value,"page-type":"purchase","get-detail-data":q},null,8,["selected-data"]),l(d,{type:"success",onClick:Se},{default:n(()=>e[20]||(e[20]=[b("导出")])),_:1})])]),Ae((_(),y(A,{ref:"multipleTableRef",data:X.value,border:"",stripe:"","header-cell-style":ie(Ge),"summary-method":fe,"show-summary":"",onSelectionChange:ye,style:{"table-layout":"auto"}},{default:n(()=>[l(m,{fixed:"left",type:"selection",width:"55",align:"center"}),l(m,{type:"index",fixed:"left",width:"55"},{header:n(()=>[s("div",{style:{cursor:"pointer",color:"red"},onClick:ce},[l(Ue,null,{default:n(()=>[l(ie(Le),{size:30})]),_:1})])]),_:1}),(_(!0),F(U,null,L(_e.value,a=>(_(),F(U,{key:a.id},[a.name==="操作"?(_(),y(m,{key:0,label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":"150"},{default:n(f=>[s("div",lt,[s("div",nt,[l(z,{"selected-data":[f.row],"page-type":"purchase","get-detail-data":q,"is-text-button":""},null,8,["selected-data"])]),s("div",st,[l(d,{type:"primary",link:"",onClick:B=>T(f.row)},{default:n(()=>e[21]||(e[21]=[b("详情")])),_:2},1032,["onClick"])]),s("div",ot,[f.row.status==0?(_(),y(d,{key:0,type:"primary",link:"",onClick:B=>xe(f.row)},{default:n(()=>e[22]||(e[22]=[b("编辑")])),_:2},1032,["onClick"])):G("",!0)])])]),_:2},1032,["label","align","fixed"])):a.name==="金额(元)"?(_(),y(m,{key:1,prop:"all_price",label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":"120",sortable:""},{default:n(f=>[b(v(Number(f.row.all_price||0).toFixed(2)),1)]),_:2},1032,["label","align","fixed"])):a.name==="付款金额(元)"?(_(),y(m,{key:2,prop:"pay_price",label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":"140",sortable:""},{default:n(f=>[s("span",rt,v((f.row.pay_price||0).toFixed(2)),1)]),_:2},1032,["label","align","fixed"])):a.name==="应付金额(元)"?(_(),y(m,{key:3,prop:"qian_price",label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":"160",sortable:""},{default:n(f=>[s("span",it,v((f.row.qian_price||0).toFixed(2)),1)]),_:2},1032,["label","align","fixed"])):a.name==="状态"?(_(),y(m,{key:4,prop:"status",label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":"120"},{default:n(f=>[s("span",null,v(f.row.status===0?"未审核":f.row.status===1?"待付款":f.row.status===2?"已还部分":"已结清"),1)]),_:2},1032,["label","align","fixed"])):(_(),y(m,{key:5,prop:ve(a.name),label:a.showName,align:a.align==="default"?"":a.align,fixed:N(a.flex),"min-width":he(a.name),sortable:a.name==="制单时间"||a.name==="金额(元)"||a.name==="付款金额(元)"||a.name==="应付金额(元)"},null,8,["prop","label","align","fixed","min-width","sortable"]))],64))),128))]),_:1},8,["data","header-cell-style"])),[[Ye,k.value]]),l(He,{class:"mt10",background:"",layout:"prev, pager, next,->,total,jumper","current-page":u.page,"onUpdate:currentPage":e[11]||(e[11]=a=>u.page=a),"page-size":u.limit,total:K.value,onCurrentChange:D},null,8,["current-page","page-size","total"])]),_:1}),l(Me,{modelValue:$.value,"onUpdate:modelValue":e[12]||(e[12]=a=>$.value=a),title:"采购账单详情","z-index":"2000",direction:ge.value,"before-close":Fe,size:"50%"},{default:n(()=>{var a,f,B,oe;return[s("div",ut,[s("div",dt,[e[25]||(e[25]=s("span",null,"基本信息",-1)),s("div",pt,[r.value.status===1?(_(),y(d,{key:0,type:"warning",onClick:Ve},{default:n(()=>e[23]||(e[23]=[b("反审核")])),_:1})):G("",!0),l(d,{type:"primary",onClick:ke},{default:n(()=>e[24]||(e[24]=[b("还款")])),_:1}),l(z,{share:"","selected-data":[Z.value],"page-type":"purchase","get-detail-data":q},null,8,["selected-data"])])]),s("div",mt,[s("div",ct,[s("span",null,"采购编号："+v(r.value.order_sn),1),s("span",null,"经手人："+v(((a=r.value.staff)==null?void 0:a.name)||""),1)]),s("div",ft,[s("span",null,[b("供应单位："+v(((f=r.value.supplier)==null?void 0:f.name)||"")+" ",1),l(d,{type:"text",onClick:Ce},{default:n(()=>e[26]||(e[26]=[b("历史")])),_:1})]),s("span",null,"电话："+v(((B=r.value.supplier)==null?void 0:B.phone)||""),1)]),s("div",_t,[s("span",null,"仓库："+v(((oe=r.value.warehouse)==null?void 0:oe.name)||""),1),s("span",null,"制单时间："+v(r.value.created_at),1)])]),s("div",vt,[s("div",ht,[e[27]||(e[27]=s("span",null,"订单金额",-1)),s("span",null,v(r.value.all_price||0)+"元",1)]),s("div",gt,[e[28]||(e[28]=s("span",null,"已付金额",-1)),s("span",null,v(r.value.pay_price||0)+"元",1)]),s("div",bt,[e[29]||(e[29]=s("span",null,"应付金额",-1)),s("span",wt,v(r.value.qian_price||0)+"元",1)]),s("div",yt,[e[30]||(e[30]=s("span",null,"状态",-1)),s("span",xt,v(r.value.status===0?"未审核":r.value.status===1?"待付款":r.value.status===2?"已还部分":"已结清"),1)])]),e[31]||(e[31]=s("div",{class:"drawer-header"},[s("span",null,"货品信息")],-1)),s("div",Vt,[l(A,{class:"little-table",data:r.value.purchaseGoods||[],style:{width:"100%"},height:"150px","header-cell-style":{background:"#f5f7fa",color:"rgba(0, 0, 0, .8)"}},{default:n(()=>[l(m,{prop:"goods_name",label:"货品"}),l(m,{label:"数量(重量)",width:"200"},{default:n(V=>[b(v(Pe(V.row)),1)]),_:1}),l(m,{label:"副单位",width:"150"},{default:n(V=>[b(v(V.row.f_stock&&V.row.f_unit?`${V.row.f_stock}${V.row.f_unit}`:""),1)]),_:1}),l(m,{prop:"unit_price",label:"单价",width:"150"}),l(m,{label:"小计",width:"150"},{default:n(V=>[b(v((V.row.num*V.row.unit_price).toFixed(2)),1)]),_:1})]),_:1},8,["data"])]),e[32]||(e[32]=s("div",{class:"drawer-header"},[s("span",null,"还款记录")],-1)),s("div",kt,[l(A,{class:"little-table",data:r.value.purchasePay||[],style:{width:"100%"},height:"150px","header-cell-style":{background:"#f5f7fa",color:"rgba(0, 0, 0, .8)"}},{default:n(()=>[l(m,{prop:"price","min-width":"150",label:"付款金额"}),l(m,{prop:"created_at",label:"付款时间","min-width":"150"})]),_:1},8,["data"])])])]}),_:1},8,["modelValue","direction"]),l(We,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=a=>E.value=a),"supplier-name":((te=r.value.supplier)==null?void 0:te.name)||"",payable:r.value.qian_price||0,"supplier-id":((ae=r.value.supplier)==null?void 0:ae.id)||r.value.supplier_id||"","purchase-id":r.value.id||"",onSave:De},null,8,["modelValue","supplier-name","payable","supplier-id","purchase-id"]),l(Xe,{modelValue:R.value,"onUpdate:modelValue":e[14]||(e[14]=a=>R.value=a),"supplier-id":((le=r.value.supplier)==null?void 0:le.id)||r.value.supplier_id||"","supplier-info":{name:((ne=r.value.supplier)==null?void 0:ne.name)||"",phone:((se=r.value.supplier)==null?void 0:se.phone)||""},onViewDetail:Ne},null,8,["modelValue","supplier-id","supplier-info"])]),l(ze,{modelValue:M.value,"onUpdate:modelValue":e[15]||(e[15]=a=>M.value=a),"header-title":Y,onSave:pe,onClose:me},null,8,["modelValue","header-title"])],64)}}}),Mt=Qe(Dt,[["__scopeId","data-v-d4c637fc"]]);export{Mt as default};
