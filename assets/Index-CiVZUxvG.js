import{d as ue,l as re,m as te,r as _,w as ve,a as c,j as ae,b as $,h as l,g as t,k as m,e as s,c as R,F as W,i as le,p as se,t as b,q as ye,s as de,v as we,x as he,A as N,E as Q,y as ce,n as ke,_ as pe,u as xe,o as Ve,z as Ce,B as De,C as ie,D as $e}from"./index-BUVdxLJQ.js";const Ae={class:"account-selector"},Fe=["onClick"],Be=["src"],Ne={class:"account-name"},Ye={class:"item-selector"},Ue=["onClick"],ze={class:"item-name"},Me=ue({__name:"BudgetRecordDialog",props:{modelValue:{type:Boolean},recordData:{}},emits:["update:modelValue","save"],setup(oe,{emit:G}){const v=oe,S=G,Y=re({get:()=>v.modelValue,set:n=>S("update:modelValue",n)}),U=re(()=>{var n;return!!((n=v.recordData)!=null&&n.id)}),o=te({type:"expense",amount:"",account_id:"",item_id:"",remark:""}),T={type:[{required:!0,message:"请选择类型",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确的金额格式",trigger:"blur"}],account_id:[{required:!0,message:"请选择账户",trigger:"change"}],item_id:[{required:!0,message:"请选择收支项",trigger:"change"}]},L=_([]),I=_([]),A=_(!1),V=te({name:"",type:"expense"}),y={name:[{required:!0,message:"请输入名称",trigger:"blur"}]},C=_(),H=_(),F=_(!1),B=_(!1);function j(n){console.log(n),o.account_id=n}function J(n){o.item_id=n}function K(){o.item_id="",o.account_id="",E()}function O(){V.type=o.type,V.name="",A.value=!0}async function X(){if(H.value)try{await H.value.validate(),B.value=!0,await N.addBudgetObject({name:V.name,type:V.type==="income"?1:2}),Q.success("添加成功"),A.value=!1,E()}catch(n){console.error("添加失败:",n)}finally{B.value=!1}}async function Z(n){try{await ce.confirm(`确定要删除"${n.name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await N.budgetObjectDelete(n.id),Q.success("删除成功"),o.item_id===n.id&&(o.item_id=""),E()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),Q.error("删除失败"))}}async function q(){try{const n=await N.accountList({page:1,limit:999});(n==null?void 0:n.code)===1e4&&(L.value=Array.isArray(n.data)?n.data:[])}catch(n){console.error("获取账户列表失败:",n)}}async function E(){try{const n=o.type==="income"?1:2,e=await N.budgetObjectList({page:1,limit:999,type:n,status:1});(e==null?void 0:e.code)===1e4&&(I.value=Array.isArray(e.data)?e.data:[])}catch(n){console.error("获取收支项列表失败:",n)}}function P(){o.type="expense",o.amount="",o.account_id="",o.item_id="",o.remark="",C.value&&C.value.resetFields()}function ee(n){o.type=n.type||"expense",o.amount=n.amount||"",o.account_id=n.account_id||"",o.item_id=n.item_id||"",o.remark=n.remark||""}async function z(){if(C.value)try{await C.value.validate(),F.value=!0;const n={object_id:o.item_id||"",type:o.type==="income"?"1":"2",cash_bank_account_id:o.account_id||"",remark:o.remark||"",price:String(o.amount||"")};await N.budgetLogCreate(n),Q.success("保存成功"),S("save",n),Y.value=!1}catch(n){console.error("保存失败:",n)}finally{F.value=!1}}return ve(()=>Y.value,n=>{n?(q(),v.recordData?(console.log(v.recordData),v.recordData.type="expense",v.recordData.amount=v.recordData.price,v.recordData.account_id=v.recordData.cashBankAccount.id,v.recordData.item_id=v.recordData.budgetObject.id,j(v.recordData.account_id),ee(v.recordData)):P(),ke(()=>{E()})):P()},{immediate:!1}),(n,e)=>{const a=c("el-radio-button"),d=c("el-radio-group"),p=c("el-form-item"),g=c("el-col"),w=c("el-input"),k=c("el-row"),f=c("el-icon"),i=c("el-button"),D=c("el-form"),M=c("el-dialog");return $(),ae(M,{modelValue:Y.value,"onUpdate:modelValue":e[8]||(e[8]=u=>Y.value=u),title:U.value?"编辑收支记录":"录收支记录",width:"760px","append-to-body":"","destroy-on-close":""},{footer:l(()=>[t(i,{onClick:e[4]||(e[4]=u=>Y.value=!1)},{default:l(()=>e[12]||(e[12]=[m("取消")])),_:1}),t(i,{type:"primary",onClick:z,loading:F.value},{default:l(()=>e[13]||(e[13]=[m("保存")])),_:1},8,["loading"])]),default:l(()=>[t(D,{model:o,rules:T,ref_key:"formRef",ref:C,"label-width":"100px"},{default:l(()=>[t(k,{gutter:20},{default:l(()=>[t(g,{span:12},{default:l(()=>[t(p,{label:"类型",prop:"type"},{default:l(()=>[t(d,{modelValue:o.type,"onUpdate:modelValue":e[0]||(e[0]=u=>o.type=u),onChange:K},{default:l(()=>[t(a,{label:"expense"},{default:l(()=>e[9]||(e[9]=[m("支出")])),_:1}),t(a,{label:"income"},{default:l(()=>e[10]||(e[10]=[m("收入")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(g,{span:12},{default:l(()=>[t(p,{label:"金额",prop:"amount"},{default:l(()=>[t(w,{modelValue:o.amount,"onUpdate:modelValue":e[1]||(e[1]=u=>o.amount=u),placeholder:"请输入金额",type:"number"},{append:l(()=>e[11]||(e[11]=[m("元")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(p,{label:o.type==="income"?"收款方式":"付款方式",prop:"account_id"},{default:l(()=>[s("div",Ae,[($(!0),R(W,null,le(L.value,u=>($(),R("div",{key:u.id,class:se(["account-item",{active:o.account_id===u.id}]),onClick:h=>j(u.id)},[s("img",{src:u.icon||"/src/assets/images/icon/payIcon1.png",class:"account-icon"},null,8,Be),s("div",Ne,b(u.name),1)],10,Fe))),128))])]),_:1},8,["label"]),t(p,{label:o.type==="income"?"收入项":"支出项",prop:"item_id"},{default:l(()=>[s("div",Ye,[($(!0),R(W,null,le(I.value,u=>($(),R("div",{key:u.id,class:se(["item-item",{active:o.item_id===u.id}]),onClick:h=>J(u.id)},[s("span",ze,b(u.name),1),s("div",{class:"item-actions",onClick:e[2]||(e[2]=ye(()=>{},["stop"]))},[t(i,{type:"danger",size:"small",circle:"",onClick:h=>Z(u),class:"delete-btn"},{default:l(()=>[t(f,null,{default:l(()=>[t(de(we))]),_:1})]),_:2},1032,["onClick"])])],10,Ue))),128)),s("div",{class:"item-item add-item",onClick:O},[t(f,null,{default:l(()=>[t(de(he))]),_:1}),s("span",null,"添加"+b(o.type==="income"?"收入":"支出")+"项",1)])])]),_:1},8,["label"]),t(p,{label:"备注"},{default:l(()=>[t(w,{modelValue:o.remark,"onUpdate:modelValue":e[3]||(e[3]=u=>o.remark=u),type:"textarea",rows:3,placeholder:"请填写备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(M,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=u=>A.value=u),title:`添加${o.type==="income"?"收入":"支出"}项`,width:"400px","append-to-body":""},{footer:l(()=>[t(i,{onClick:e[6]||(e[6]=u=>A.value=!1)},{default:l(()=>e[14]||(e[14]=[m("取消")])),_:1}),t(i,{type:"primary",onClick:X,loading:B.value},{default:l(()=>e[15]||(e[15]=[m("确认")])),_:1},8,["loading"])]),default:l(()=>[t(D,{model:V,rules:y,ref_key:"itemFormRef",ref:H,"label-width":"80px"},{default:l(()=>[t(p,{label:"名称",prop:"name"},{default:l(()=>[t(w,{modelValue:V.name,"onUpdate:modelValue":e[5]||(e[5]=u=>V.name=u),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])}}}),Re=pe(Me,[["__scopeId","data-v-2c3702e0"]]),Le={class:"page p10"},Ie={class:"left-actions"},je={class:"page p10"},Ee={class:"actions"},He={class:"left-actions"},Se={class:"right-search"},Te={class:"drawer-container"},Oe={class:"drawer-header"},qe={class:"drawer-btns"},Pe={class:"basic-info"},Qe={class:"info-item"},We={class:"info-item"},Ge={class:"info-item"},Je={class:"bill-content"},Ke={class:"bill-item"},Xe={key:0,class:"bill-item"},Ze=ue({__name:"Index",setup(oe){const G=["price"],v=e=>S({...e,sumFields:G}),S=({columns:e,data:a,sumFields:d})=>{const p=[],g={};let w=0,k=0;return d&&Array.isArray(d)&&(d.forEach(f=>{g[f]=0}),a.forEach(f=>{d.forEach(i=>{Number(f.type)===1?w+=Number(f[i])||0:k+=Number(f[i])||0,g[i]+=Number(f[i])||0})})),e.forEach((f,i)=>{const D=f.property;if(i===0){p[i]="合计";return}if(!D){p[i]="";return}if(d&&d.includes(D)){if(D.includes("amount")||D.includes("price")){const M=w-k;p[i]=M.toFixed(2)}else p[i]=g[D].toString();return}p[i]=""}),p},Y=[{text:"昨天",value:()=>{const e=new Date;e.setDate(e.getDate()-1),e.setHours(0,0,0,0);const a=new Date(e);return a.setHours(23,59,59,999),[e,a]}},{text:"今天",value:()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]}},{text:"本月",value:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),1),d=new Date(e.getFullYear(),e.getMonth()+1,0);return d.setHours(23,59,59,999),[a,d]}},{text:"上月",value:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth()-1,1),d=new Date(e.getFullYear(),e.getMonth(),0);return d.setHours(23,59,59,999),[a,d]}},{text:"本年",value:()=>{const e=new Date,a=new Date(e.getFullYear(),0,1),d=new Date(e.getFullYear(),11,31);return d.setHours(23,59,59,999),[a,d]}},{text:"上年",value:()=>{const e=new Date,a=new Date(e.getFullYear()-1,0,1),d=new Date(e.getFullYear()-1,11,31);return d.setHours(23,59,59,999),[a,d]}}];xe();const U=_([]),o=te({page:1,limit:15,keyword:"",type:"",cash_bank_account_id:""}),T=_(""),L=_(),I=_(!1),A=_(0),V=_([]),y=_({}),C=_(!1),H=_("rtl"),F=_(!1),B=_(null),j=()=>{z()},J=()=>{o.keyword="",o.type="",o.cash_bank_account_id="",z()},K=()=>{B.value=null,F.value=!0},O=()=>{const e=X(),a=window.open("","_blank");a&&(a.document.write(e),a.document.close(),a.focus(),a.print(),a.close())},X=()=>{var a;let e=`
    <html>
    <head>
      <title>收支记录报表</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; font-size: 12px; }
        .print-header { text-align: center; margin-bottom: 20px; font-size: 16px; font-weight: bold; }
        .print-time { text-align: right; margin-bottom: 10px; color: #666; font-size: 12px; }
        .print-summary { text-align: center; margin-bottom: 15px; color: #333; font-size: 14px; }
        table { 
          width: 100%; 
          border-collapse: separate; 
          border-spacing: 0; 
          margin-top: 10px; 
          table-layout: fixed;
          border: 1px solid #666;
        }
        th, td { 
          border-right: 1px solid #666;
          border-bottom: 1px solid #666;
          padding: 6px; 
          text-align: left; 
          background-color: transparent !important;
          word-wrap: break-word;
          overflow-wrap: break-word;
          font-size: 10px;
          margin: 0;
        }
        th { font-weight: bold; text-align: center; }
        th:last-child, td:last-child {
          border-right: none;
        }
        tr:last-child td {
          border-bottom: none;
        }
        .amount { text-align: right; }
        .type-income { color: #67C23A; }
        .type-expense { color: #F56C6C; }
        .center { text-align: center; }
        @media print {
          body { margin: 0; padding: 10px; }
          .print-time { display: none; }
          thead { display: table-header-group; }
          tfoot { display: table-footer-group; }
          table { 
            width: 100% !important; 
            max-width: 100% !important;
            border: 1px solid #666 !important;
            border-collapse: collapse !important;
          }
          tr, th, td { page-break-inside: avoid; break-inside: avoid; }
          th, td { 
            border: 1px solid #666 !important;
            background-color: transparent !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            font-size: 10px !important;
            padding: 6px !important;
            margin: 0 !important;
          }
        }
      </style>
    </head>
    <body>
      <div class="print-time">打印时间：${new Date().toLocaleString()}</div>
      <div class="print-header">收支记录报表</div>
      <div class="print-summary">共 ${A.value} 条记录</div>
      <table>
        <thead>
          <tr>
            <th style="width: 8%;">序号</th>
            <th style="width: 10%;">类型</th>
            <th style="width: 15%;">金额(元)</th>
            <th style="width: 18%;">收款/付款方式</th>
            <th style="width: 15%;">收支项目</th>
            <th style="width: 12%;">经手人</th>
            <th style="width: 22%;">操作时间</th>
          </tr>
        </thead>
        <tbody>
  `;return(a=L.value)==null||a.forEach((d,p)=>{var w,k,f;const g=Number(d.type)===1;e+="<tr>",e+=`<td class="center">${(o.page-1)*o.limit+p+1}</td>`,e+=`<td class="center">${g?"收入":"支出"}</td>`,e+=`<td >${Number(d.price||0).toFixed(2)}</td>`,e+=`<td>${((w=d.cashBankAccount)==null?void 0:w.name)||""}</td>`,e+=`<td>${((k=d.budgetObject)==null?void 0:k.name)||""}</td>`,e+=`<td>${((f=d.user)==null?void 0:f.nickname)||""}</td>`,e+=`<td>${d.created_at||""}</td>`,e+="</tr>"}),e+=`
        </tbody>
      </table>
    </body>
    </html>
  `,e},Z=e=>{U.value=e},q=async e=>{B.value=U.value[0],F.value=!0},E=e=>{ce.confirm("确认删除吗").then(async()=>{const a=await N.budgetObjectDelete(U.value[0].id);console.log(a)})},P=async()=>{await z(),F.value=!1,B.value=null,C.value=!1},ee=async()=>{try{const e=await N.accountList({page:1,limit:999});(e==null?void 0:e.code)===1e4&&(V.value=Array.isArray(e.data)?e.data:[])}catch(e){console.error("获取账户列表失败:",e)}},z=()=>{I.value=!0,N.budgetLogList(o).then(e=>{L.value=e.data,A.value=e.total,I.value=!1})},n=()=>{C.value=!1};return Ve(()=>{ee(),z()}),(e,a)=>{const d=c("el-date-picker"),p=c("el-form-item"),g=c("el-col"),w=c("el-input"),k=c("el-option"),f=c("el-select"),i=c("el-button"),D=c("el-row"),M=c("el-form"),u=c("el-card"),h=c("el-table-column"),me=c("el-tag"),_e=c("el-table"),fe=c("el-pagination"),ge=c("el-drawer"),be=Ce("loading");return $(),R(W,null,[s("div",Le,[t(u,{shadow:"never"},{default:l(()=>[s("div",Ie,[t(M,{inline:!0,model:o,"label-width":"auto"},{default:l(()=>[t(D,{gutter:20},{default:l(()=>[t(g,{span:6},{default:l(()=>[t(p,{label:"时间："},{default:l(()=>[t(d,{style:{width:"193px"},modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=r=>T.value=r),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss",shortcuts:Y},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,{label:"项目名称："},{default:l(()=>[t(w,{modelValue:o.order_sn,"onUpdate:modelValue":a[1]||(a[1]=r=>o.order_sn=r),placeholder:"请输入项目名称："},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,{label:"条形码："},{default:l(()=>[t(w,{modelValue:o.phone,"onUpdate:modelValue":a[2]||(a[2]=r=>o.phone=r),placeholder:"请输入条形码"},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,{label:"经手人："},{default:l(()=>[t(w,{modelValue:o.phone,"onUpdate:modelValue":a[3]||(a[3]=r=>o.phone=r),placeholder:"请输入经手人："},null,8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,{label:"类型："},{default:l(()=>[t(f,{style:{width:"193px"},modelValue:o.type,"onUpdate:modelValue":a[4]||(a[4]=r=>o.type=r),placeholder:"请选择类型",clearable:"",onChange:j},{default:l(()=>[t(k,{label:"收入",value:1}),t(k,{label:"支出",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,{label:"账户"},{default:l(()=>[t(f,{style:{width:"193px"},modelValue:o.cash_bank_account_id,"onUpdate:modelValue":a[5]||(a[5]=r=>o.cash_bank_account_id=r),placeholder:"请选择账户",clearable:"",onChange:j},{default:l(()=>[($(!0),R(W,null,le(V.value,r=>($(),ae(k,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(g,{span:6},{default:l(()=>[t(p,null,{default:l(()=>[t(i,{type:"primary",onClick:j},{default:l(()=>a[10]||(a[10]=[m("查询")])),_:1})]),_:1}),t(p,null,{default:l(()=>[t(i,{onClick:J},{default:l(()=>a[11]||(a[11]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),s("div",je,[t(u,{shadow:"never"},{default:l(()=>[s("div",Ee,[s("div",He,[t(i,{type:"primary",onClick:K},{default:l(()=>a[12]||(a[12]=[m("录收支记录")])),_:1}),t(i,{onClick:O,type:"primary"},{default:l(()=>a[13]||(a[13]=[m("打印")])),_:1}),t(i,{type:"primary"},{default:l(()=>a[14]||(a[14]=[m("审核")])),_:1}),t(i,{type:"primary"},{default:l(()=>a[15]||(a[15]=[m("反审核")])),_:1}),t(i,{onClick:q,type:"warning",disabled:U.value.length!=1},{default:l(()=>a[16]||(a[16]=[m("编辑")])),_:1},8,["disabled"]),t(i,{onClick:E,type:"danger",disabled:U.value.length!=1},{default:l(()=>a[17]||(a[17]=[m("删除")])),_:1},8,["disabled"])]),s("div",Se,[t(M,{inline:!0,model:o,class:"demo-form-inline"},null,8,["model"])])]),De(($(),ae(_e,{ref:"multipleTableRef",showSummary:!0,"summary-method":v,data:L.value,border:"",stripe:"",onSelectionChange:Z},{default:l(()=>[t(h,{type:"selection",width:"55"}),t(h,{type:"index",label:"序号",width:"55"}),t(h,{prop:"type",label:"类型",width:"100"},{default:l(r=>[t(me,{type:Number(r.row.type)===1?"success":"danger"},{default:l(()=>[m(b(Number(r.row.type)===1?"收入":"支出"),1)]),_:2},1032,["type"])]),_:1}),t(h,{prop:"price",label:"金额(元)",width:"120",sortable:""},{default:l(r=>[s("span",{style:ie({color:Number(r.row.type)===1?"#67C23A":"#F56C6C"})},b(Number(r.row.price||0).toFixed(2)),5)]),_:1}),t(h,{"min-width":"140",label:"收款/付款方式"},{default:l(r=>{var x;return[m(b(((x=r.row.cashBankAccount)==null?void 0:x.name)||""),1)]}),_:1}),t(h,{"min-width":"120",label:"收支项目"},{default:l(r=>{var x;return[m(b(((x=r.row.budgetObject)==null?void 0:x.name)||""),1)]}),_:1}),t(h,{"min-width":"100",label:"经手人"},{default:l(r=>{var x;return[m(b(((x=r.row.user)==null?void 0:x.nickname)||""),1)]}),_:1}),t(h,{prop:"created_at",label:"操作时间",width:"180"}),t(h,{prop:"remark","min-width":"150",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"])),[[be,I.value]]),t(fe,{class:"mt10",background:"",layout:"prev, pager, next,->,total,jumper","current-page":o.page,"onUpdate:currentPage":a[6]||(a[6]=r=>o.page=r),"page-size":o.limit,total:A.value,onCurrentChange:z},null,8,["current-page","page-size","total"])]),_:1}),t(ge,{modelValue:C.value,"onUpdate:modelValue":a[8]||(a[8]=r=>C.value=r),title:"收支记录详情","z-index":"2000",direction:H.value,"before-close":n,size:"50%"},{default:l(()=>{var r,x,ne;return[s("div",Te,[s("div",Oe,[a[20]||(a[20]=s("span",null,"基本信息",-1)),s("div",qe,[t(i,{type:"primary",onClick:a[7]||(a[7]=et=>q(y.value))},{default:l(()=>a[18]||(a[18]=[m("编辑")])),_:1}),t(i,{onClick:O},{default:l(()=>a[19]||(a[19]=[m("打印")])),_:1})])]),s("div",Pe,[s("div",Qe,[s("span",null,"编号："+b(y.value.id),1),s("span",null,"经手人："+b(((r=y.value.user)==null?void 0:r.nickname)||""),1)]),s("div",We,[s("span",null,"类型："+b(Number(y.value.type)===1?"收入":"支出"),1),s("span",null,"操作时间："+b(y.value.created_at),1)]),s("div",Ge,[s("span",null,"账户："+b(((x=y.value.cashBankAccount)==null?void 0:x.name)||""),1),s("span",null,"收支项目："+b(((ne=y.value.budgetObject)==null?void 0:ne.name)||""),1)])]),s("div",Je,[s("div",Ke,[a[21]||(a[21]=s("span",null,"金额",-1)),s("span",{style:ie({color:Number(y.value.type)===1?"#67C23A":"#F56C6C"})},b(Number(y.value.price||0).toFixed(2))+"元 ",5)]),y.value.remark?($(),R("div",Xe,[a[22]||(a[22]=s("span",null,"备注",-1)),s("span",null,b(y.value.remark),1)])):$e("",!0)])])]}),_:1},8,["modelValue","direction"]),t(Re,{modelValue:F.value,"onUpdate:modelValue":a[9]||(a[9]=r=>F.value=r),"record-data":B.value,onSave:P},null,8,["modelValue","record-data"])])],64)}}}),at=pe(Ze,[["__scopeId","data-v-92216fc4"]]);export{at as default};
