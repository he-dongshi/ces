import{d as L,r as k,m as O,l as Q,o as G,a as i,z as H,c as x,b as f,g as o,h as s,e as J,B as P,F as C,i as F,j as Y,I as W,k as p,t as g,A as M,_ as X}from"./index-BUVdxLJQ.js";const Z={class:"inventory-balance page p10"},ee={class:"actions"},te=L({__name:"Index",setup(ae){const $=()=>{const a=new Date,e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${t}`},N=k(!1),S=k([]),w=k([]),V=k([]),d=O({time:$(),warehouse_id:"",cate_id:"",goods_keyword:""}),T=Q(()=>w.value||[]),B=()=>{q()},A=()=>{d.time=$(),d.warehouse_id="",d.cate_id="",d.goods_keyword="",q()},v=a=>{const e=Number(a)||0;return e%1===0?e.toString():e.toFixed(2)},y=a=>(Number(a)||0).toFixed(2),E=({columns:a,data:e})=>{const n=[],t=e.reduce((c,r)=>c+(Number(r.total_quantity)||0),0),_=e.reduce((c,r)=>c+(Number(r.total_amount)||0),0);return a.forEach((c,r)=>{const m=c.property;if(r===0){n[r]="合计";return}if(!m){n[r]="";return}if(m==="total_quantity"){n[r]=v(t);return}if(m==="total_cost_price"){n[r]=t>0?y(_/t):"0.00";return}if(m==="total_amount"){n[r]=y(_);return}if(m.includes("_quantity")){const b=e.reduce((h,u)=>h+(Number(u[m])||0),0);n[r]=v(b);return}if(m.includes("_amount")){const b=e.reduce((h,u)=>h+(Number(u[m])||0),0);n[r]=y(b);return}n[r]=""}),n},I=a=>{const e=a.goods_info||{},n=a.total_summary||{},t={goods_number:e.number||"--",goods_name:e.name||"--",cate_name:e.cate_name||"--",attribute:e.attribute||"--",spec_name:e.spec_name||"--",unit_name:e.unit_name||"--",auxiliary_unit:e.auxiliary_unit||e.f_unit_name||"--",total_quantity:Number(n.quantity)||0,total_cost_price:Number(n.cost_price)||0,total_amount:Number(n.total_amount)||0};return w.value.forEach(_=>{var r;const c=((r=a.warehouse_balances)==null?void 0:r[_.id])||{};t[`warehouse_${_.id}_quantity`]=Number(c.quantity)||0,t[`warehouse_${_.id}_amount`]=Number(c.total_amount)||0}),t},q=async()=>{var a,e;N.value=!0;try{const n={time:d.time,warehouse_id:d.warehouse_id,cate_id:d.cate_id,goods_keyword:d.goods_keyword},t=await M.inventoryFlowBalance(n);w.value=((a=t==null?void 0:t.data)==null?void 0:a.warehouses)||[];const _=((e=t==null?void 0:t.data)==null?void 0:e.data)||[];S.value=_.map(c=>I(c))}finally{N.value=!1}},U=async()=>{try{const a=await M.list("goods_cate",{page:1,limit:9999}),e=Array.isArray(a==null?void 0:a.data)?a.data:[];V.value=K(e)}catch{V.value=[]}},K=a=>{const e={},n=[];return a.forEach(t=>{e[t.id]={...t,children:[]}}),a.forEach(t=>{t.p_id&&e[t.p_id]?e[t.p_id].children.push(e[t.id]):n.push(e[t.id])}),n};return G(()=>{U(),q()}),(a,e)=>{const n=i("el-date-picker"),t=i("el-form-item"),_=i("el-option"),c=i("el-select"),r=i("el-tree-select"),m=i("el-input"),b=i("el-button"),h=i("el-form"),u=i("el-table-column"),R=i("el-table"),j=i("el-card"),z=H("loading");return f(),x("div",Z,[o(j,{shadow:"never"},{default:s(()=>[J("div",ee,[o(h,{inline:!0,model:d},{default:s(()=>[o(t,{label:"时间"},{default:s(()=>[o(n,{modelValue:d.time,"onUpdate:modelValue":e[0]||(e[0]=l=>d.time=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"请选择日期",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),o(t,{label:"仓库"},{default:s(()=>[o(c,{modelValue:d.warehouse_id,"onUpdate:modelValue":e[1]||(e[1]=l=>d.warehouse_id=l),placeholder:"全部仓库",clearable:"",style:{width:"180px"}},{default:s(()=>[(f(!0),x(C,null,F(T.value,l=>(f(),Y(_,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(t,{label:"商品分类"},{default:s(()=>[o(r,{modelValue:d.cate_id,"onUpdate:modelValue":e[2]||(e[2]=l=>d.cate_id=l),data:V.value,"node-key":"id","check-strictly":"",clearable:"","render-after-expand":!1,placeholder:"请选择分类",style:{width:"220px"}},null,8,["modelValue","data"])]),_:1}),o(t,{label:"商品信息"},{default:s(()=>[o(m,{modelValue:d.goods_keyword,"onUpdate:modelValue":e[3]||(e[3]=l=>d.goods_keyword=l),placeholder:"编号/名称/条码/规格",style:{width:"220px"},clearable:"",onKeyup:W(B,["enter"])},null,8,["modelValue"])]),_:1}),o(t,null,{default:s(()=>[o(b,{type:"primary",onClick:B},{default:s(()=>e[4]||(e[4]=[p("查询")])),_:1}),o(b,{onClick:A},{default:s(()=>e[5]||(e[5]=[p("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),P((f(),Y(R,{class:"mt20",data:S.value,border:"",stripe:"","show-summary":!0,"summary-method":E,style:{width:"100%"}},{default:s(()=>[o(u,{prop:"goods_number",label:"商品编号",width:"120",align:"center"}),o(u,{prop:"goods_name",label:"商品名称",width:"150",align:"center"}),o(u,{prop:"cate_name",label:"商品分类",width:"120",align:"center"}),o(u,{prop:"attribute",label:"属性",width:"100",align:"center"}),o(u,{prop:"spec_name",label:"规格",width:"120",align:"center"}),o(u,{prop:"unit_name",label:"单位",width:"100",align:"center"}),o(u,{prop:"auxiliary_unit",label:"辅单位",width:"100",align:"center"}),o(u,{label:"所有仓库",align:"center"},{default:s(()=>[o(u,{prop:"total_quantity",label:"数量",width:"120",align:"center"},{default:s(({row:l})=>[p(g(v(l.total_quantity)),1)]),_:1}),o(u,{prop:"total_cost_price",label:"成本价",width:"120",align:"center"},{default:s(({row:l})=>[p(g(y(l.total_cost_price)),1)]),_:1}),o(u,{prop:"total_amount",label:"成本总额",width:"150",align:"center"},{default:s(({row:l})=>[p(g(y(l.total_amount)),1)]),_:1})]),_:1}),(f(!0),x(C,null,F(w.value,l=>(f(),Y(u,{key:l.id,label:l.name,align:"center"},{default:s(()=>[o(u,{prop:`warehouse_${l.id}_quantity`,label:"数量",width:"120",align:"center"},{default:s(({row:D})=>[p(g(v(D[`warehouse_${l.id}_quantity`])),1)]),_:2},1032,["prop"]),o(u,{prop:`warehouse_${l.id}_amount`,label:"成本总额",width:"140",align:"center"},{default:s(({row:D})=>[p(g(y(D[`warehouse_${l.id}_amount`])),1)]),_:2},1032,["prop"])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])),[[z,N.value]])]),_:1})])}}}),le=X(te,[["__scopeId","data-v-e7cc5493"]]);export{le as default};
