import{d as j,r as y,w as E,o as ae,a as r,j as R,b as N,h as s,g as a,k as I,A as Y,l as T,e as d,t as k,c as q,F as z,i as G,E as O,_ as Q,m as J,p as oe,D as W,z as se,I as P,B as ne}from"./index-BUVdxLJQ.js";const de=j({__name:"BasketHistoryDialog",props:{modelValue:{type:Boolean},customerId:{}},emits:["update:modelValue"],setup(H,{emit:M}){const c=H,U=M,f=y("remain"),v=y([]),V=y([]),$=y([]),n=async()=>{var u;try{const e=await Y.depositReturned(c.customerId),m=((u=e==null?void 0:e.data)==null?void 0:u.data)||(e==null?void 0:e.data)||[];v.value=m}catch{v.value=[]}},C=async()=>{var u;try{const e=await Y.depositLog({type:1,customer_id:c.customerId,page:1,limit:50}),m=((u=e==null?void 0:e.data)==null?void 0:u.data)||(e==null?void 0:e.data)||[];V.value=m}catch{V.value=[]}},S=async()=>{var u;try{const e=await Y.depositLog({type:2,customer_id:c.customerId,page:1,limit:50}),m=((u=e==null?void 0:e.data)==null?void 0:u.data)||(e==null?void 0:e.data)||[];$.value=m}catch{$.value=[]}},g=async()=>{c.customerId&&await Promise.all([n(),C(),S()])};return E(()=>c.modelValue,u=>{u&&(f.value="remain",g())}),ae(()=>{c.modelValue&&g()}),(u,e)=>{const m=r("el-table-column"),B=r("el-table"),x=r("el-tab-pane"),A=r("el-tabs"),K=r("el-button"),h=r("el-dialog");return N(),R(h,{"model-value":u.modelValue,title:"历史",width:"800px","append-to-body":"",onClose:e[2]||(e[2]=l=>U("update:modelValue",!1))},{footer:s(()=>[a(K,{type:"primary",onClick:e[1]||(e[1]=l=>U("update:modelValue",!1))},{default:s(()=>e[3]||(e[3]=[I("关闭")])),_:1})]),default:s(()=>[a(A,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l)},{default:s(()=>[a(x,{label:"剩余未还",name:"remain"},{default:s(()=>[a(B,{data:v.value,border:"",style:{width:"100%"}},{default:s(()=>[a(m,{prop:"deposit.name",label:"名称"}),a(m,{prop:"num",label:"数量"})]),_:1},8,["data"])]),_:1}),a(x,{label:"押筐记录",name:"deposit"},{default:s(()=>[a(B,{data:V.value,border:"",style:{width:"100%"}},{default:s(()=>[a(m,{prop:"created_at",label:"时间","min-width":"160"}),a(m,{prop:"deposit_log.0.deposit.name",label:"筐子"}),a(m,{prop:"number",label:"数量",width:"120"}),a(m,{prop:"all_price",label:"总计金额",width:"120"})]),_:1},8,["data"])]),_:1}),a(x,{label:"还筐记录",name:"return"},{default:s(()=>[a(B,{data:$.value,border:"",style:{width:"100%"}},{default:s(()=>[a(m,{prop:"created_at",label:"时间","min-width":"160"}),a(m,{prop:"deposit_log.0.deposit.name",label:"筐子"}),a(m,{prop:"number",label:"数量",width:"120"}),a(m,{prop:"all_price",label:"总计金额",width:"120"})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model-value"])}}}),ue={class:"basket-dialog__header"},ie={class:"left"},re={class:"num"},me={class:"right"},pe={class:"money"},ce=j({__name:"BasketDialog",props:{modelValue:{type:Boolean},customerId:{},depositList:{}},emits:["update:modelValue","save"],setup(H,{emit:M}){const c=H,U=M,f=T({get:()=>c.modelValue,set:u=>U("update:modelValue",u)}),v=y([]),V=y(0),$=y(!1),n=T(()=>v.value.reduce((u,e)=>u+(Number(e.qty)||0)*(Number(e.price)||0),0)),C=()=>{if(!c.customerId){O.warning("请选择客户");return}$.value=!0},S=async()=>{try{if(!c.customerId){V.value=0;return}const u=await Y.depositNum(c.customerId),e=u==null?void 0:u.data,m=typeof e=="number"?e:Number((e==null?void 0:e.num)??(e==null?void 0:e.count)??0);V.value=isNaN(m)?0:m}catch{V.value=0}},g=async()=>{const u=v.value.map(e=>({id:e.id,number:String(Number(e.qty)||0)})).filter(e=>Number(e.number)>0);U("save",u),f.value=!1};return E(()=>f.value,u=>{u?(v.value=(c.depositList||[]).map(e=>({id:e.id,name:e.name,price:Number(e.price)||0,qty:""})),S()):v.value=[]},{immediate:!1}),(u,e)=>{const m=r("el-button"),B=r("el-input"),x=r("el-form-item"),A=r("el-form"),K=r("el-dialog");return N(),R(K,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=h=>f.value=h),title:"收筐",width:"720px","append-to-body":"","destroy-on-close":""},{footer:s(()=>[a(m,{onClick:e[0]||(e[0]=h=>f.value=!1)},{default:s(()=>e[9]||(e[9]=[I("取消")])),_:1}),a(m,{type:"primary",onClick:g},{default:s(()=>e[10]||(e[10]=[I("确认")])),_:1})]),default:s(()=>[d("div",ue,[d("div",ie,[e[4]||(e[4]=d("span",null,"欠筐数量：",-1)),d("span",re,k(V.value||0)+"个",1),a(m,{link:"",type:"primary",class:"ml5",onClick:C,disabled:!u.customerId},{default:s(()=>e[3]||(e[3]=[I("历史")])),_:1},8,["disabled"])]),d("div",me,[e[5]||(e[5]=I(" 收筐合计：")),d("span",pe,k(n.value.toFixed(2)),1),e[6]||(e[6]=I("元 "))])]),a(A,{"label-width":"60px"},{default:s(()=>[(N(!0),q(z,null,G(v.value,h=>(N(),q("div",{key:h.id,class:"basket-row"},[a(x,{label:h.name},{default:s(()=>[a(B,{modelValue:h.qty,"onUpdate:modelValue":l=>h.qty=l,placeholder:"数量",style:{width:"220px"}},{prepend:s(()=>e[7]||(e[7]=[I("数量")])),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),a(x,{label:" "},{default:s(()=>[a(B,{"model-value":Number(h.price||0).toFixed(2),readonly:"",style:{width:"220px"}},{prepend:s(()=>e[8]||(e[8]=[I("单价")])),_:2},1032,["model-value"])]),_:2},1024)]))),128))]),_:1}),a(de,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=h=>$.value=h),"customer-id":u.customerId||""},null,8,["modelValue","customer-id"])]),_:1},8,["modelValue"])}}}),_e=Q(ce,[["__scopeId","data-v-fa5424e6"]]),fe={class:"info-section"},ve={class:"info-item"},be={class:"value"},ge={style:{"margin-top":"4px",color:"#F79B2C"}},ye={class:"info-item"},Ve={class:"value highlight"},we={class:"info-item"},he={class:"value"},De={class:"info-item"},ke={class:"value"},Ie={style:{display:"flex"}},$e={class:"pay-kinds"},Ce=["onClick"],xe=["src"],Ne={class:"name"},Ue=j({__name:"PurchaseSettleDialog",props:{modelValue:{type:Boolean},customerName:{},payable:{},customerId:{},orderId:{},depositLogIds:{}},emits:["update:modelValue","save"],setup(H,{emit:M}){const c=H,U=M,f=T({get:()=>c.modelValue,set:t=>U("update:modelValue",t)}),v=y(""),V=y(""),$=y(!1),n=y([]),C=y([]),S=y([]),g=y(new Set),u=J({}),e=T(()=>S.value);function m(t){const o=g.value;o.has(t)?o.delete(t):(o.add(t),u[t]===void 0&&(u[t]=""))}async function B(){try{const t=await Y.accountList({page:1,limit:999});if((t==null?void 0:t.code)===1e4){const o=Array.isArray(t.data)?t.data:[];S.value=o.map(p=>({id:p.id,name:p.name,icon:p.icon}))}}catch{}}async function x(){try{const t=await Y.depositList({page:1,limit:999});if((t==null?void 0:t.code)===1e4){const o=Array.isArray(t.data)?t.data:[];n.value=o.map(p=>({id:p.id,name:p.name,price:p.price}))}}catch{}}function A(){$.value=!0}function K(t){C.value=t;const o=t.reduce((p,w)=>{const D=n.value.find(F=>F.id===w.id);return p+(D?D.price*Number(w.number):0)},0);v.value=o.toFixed(2)}function h(){v.value="",V.value="",g.value=new Set;for(const t in u)delete u[t]}E(()=>f.value,t=>{t?(B(),x()):h()},{immediate:!1});function l(){var D,F;const t=Array.from(g.value).map(b=>({account_id:b,amount:u[b]||""})),o=t.map(b=>({id:b.account_id,price:Number(b.amount||0)})).filter(b=>b.id&&b.price>0),p=((D=S.value.find(b=>b.name.includes("现金")))==null?void 0:D.id)||((F=S.value[0])==null?void 0:F.id),w=C.value.filter(b=>Number(b.number)>0).map(b=>b.id).join(",");Y.orderPayable({customer_id:c.customerId,price:Number(c.payable||0),cash_bank_account_id:p,mark:V.value||"还款",discount:v.value||"0",deposit_log_ids:w,order_id:c.orderId,pays:o}).then(()=>{O.success("还款成功"),U("save",{discount:v.value,remark:V.value,details:t}),f.value=!1}).catch(()=>{})}return(t,o)=>{const p=r("el-input"),w=r("el-button"),D=r("el-form-item"),F=r("el-form"),b=r("el-dialog");return N(),R(b,{modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=_=>f.value=_),title:"还款",width:"760px","append-to-body":"","destroy-on-close":""},{footer:s(()=>[a(w,{onClick:o[2]||(o[2]=_=>f.value=!1)},{default:s(()=>o[11]||(o[11]=[I("取消")])),_:1}),a(w,{type:"primary",onClick:l},{default:s(()=>o[12]||(o[12]=[I("保存")])),_:1})]),default:s(()=>[d("div",fe,[d("div",ve,[o[5]||(o[5]=d("div",{class:"label"},"买家",-1)),d("div",be,[d("div",null,k(t.customerName),1),d("div",ge,"总欠款 "+k(Number(t.payable||0).toFixed(2)),1)])]),d("div",ye,[o[6]||(o[6]=d("div",{class:"label"},"应收金额",-1)),d("div",Ve,k(Number(t.payable||0).toFixed(2)),1)]),d("div",we,[o[7]||(o[7]=d("div",{class:"label"},"优惠",-1)),d("div",he,[a(p,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=_=>v.value=_),placeholder:"金额",style:{width:"120px"}},null,8,["modelValue"])])]),d("div",De,[o[9]||(o[9]=d("div",{class:"label"},"收筐 抵扣10元",-1)),d("div",ke,[a(w,{type:"primary",size:"small",onClick:A},{default:s(()=>o[8]||(o[8]=[I("+")])),_:1})])])]),a(F,{"label-width":"100px",class:"mt10"},{default:s(()=>[d("div",Ie,[o[10]||(o[10]=d("div",{class:"label"},"支付方式",-1)),d("div",$e,[(N(!0),q(z,null,G(e.value,_=>(N(),q("div",{key:_.id,class:oe(["pay-kind",{active:g.value.has(_.id)}]),onClick:L=>m(_.id)},[d("img",{src:_.icon||"/src/assets/images/icon/payIcon1.png",class:"icon"},null,8,xe),d("div",Ne,k(_.name),1)],10,Ce))),128))])]),(N(!0),q(z,null,G(e.value,_=>(N(),q(z,{key:"amount-"+_.id},[g.value.has(_.id)?(N(),R(D,{key:0,label:_.name,class:"mt10"},{default:s(()=>[a(p,{modelValue:u[_.id],"onUpdate:modelValue":L=>u[_.id]=L,placeholder:"金额"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):W("",!0)],64))),128)),a(D,{label:"备注"},{default:s(()=>[a(p,{type:"textarea",modelValue:V.value,"onUpdate:modelValue":o[1]||(o[1]=_=>V.value=_),placeholder:"请填写备注"},null,8,["modelValue"])]),_:1})]),_:1}),a(_e,{modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=_=>$.value=_),"customer-id":c.customerId,"deposit-list":n.value,onSave:K},null,8,["modelValue","customer-id","deposit-list"])]),_:1},8,["modelValue"])}}}),ze=Q(Ue,[["__scopeId","data-v-4f158cec"]]),Be={class:"dialog-content"},Se={key:0,class:"customer-info"},Fe={style:{float:"left"}},Le={style:{float:"right"}},Ye={style:{float:"right"}},He={style:{float:"right"}},Me={class:"search-section"},Ae={class:"table-section"},Ke={style:{color:"#f56c6c"}},qe={style:{color:"#409eff"}},Pe={style:{color:"#e6a23c"}},Re=j({__name:"CustomerSalesHistoryDialog",props:{modelValue:{type:Boolean},customerId:{default:""},customerInfo:{default:()=>({name:"",phone:"",debt:0})}},emits:["update:modelValue","view-detail"],setup(H,{emit:M}){const c=H,U=M,f=T({get:()=>c.modelValue,set:l=>U("update:modelValue",l)}),v=y(!1),V=y([]),$=y(0),n=J({order_sn:"",goods:"",barcode:"",customer_phone:"",cate_id:"",brand:"",status:"",staff:""}),C=y([]),S=[{text:"昨天",value:()=>{const l=new Date;l.setDate(l.getDate()-1),l.setHours(0,0,0,0);const t=new Date(l);return t.setHours(23,59,59,999),[l,t]}},{text:"今天",value:()=>{const l=new Date;l.setHours(0,0,0,0);const t=new Date;return t.setHours(23,59,59,999),[l,t]}},{text:"本月",value:()=>{const l=new Date,t=new Date(l.getFullYear(),l.getMonth(),1),o=new Date(l.getFullYear(),l.getMonth()+1,0);return o.setHours(23,59,59,999),[t,o]}},{text:"上月",value:()=>{const l=new Date,t=new Date(l.getFullYear(),l.getMonth()-1,1),o=new Date(l.getFullYear(),l.getMonth(),0);return o.setHours(23,59,59,999),[t,o]}},{text:"本年",value:()=>{const l=new Date,t=new Date(l.getFullYear(),0,1),o=new Date(l.getFullYear(),11,31);return o.setHours(23,59,59,999),[t,o]}},{text:"上年",value:()=>{const l=new Date,t=new Date(l.getFullYear()-1,0,1),o=new Date(l.getFullYear()-1,11,31);return o.setHours(23,59,59,999),[t,o]}}],g=J({page:1,limit:10}),u=()=>{f.value=!1},e=()=>{g.page=1,x()},m=()=>{n.order_sn="",n.goods="",n.barcode="",n.customer_phone="",n.cate_id="",n.brand="",n.status="",n.staff="",C.value=[],g.page=1,x()},B=l=>{const t=l.getFullYear(),o=`${l.getMonth()+1}`.padStart(2,"0"),p=`${l.getDate()}`.padStart(2,"0"),w=`${l.getHours()}`.padStart(2,"0"),D=`${l.getMinutes()}`.padStart(2,"0"),F=`${l.getSeconds()}`.padStart(2,"0");return`${t}-${o}-${p} ${w}:${D}:${F}`},x=async()=>{if(c.customerId)try{v.value=!0;const l={page:g.page,limit:g.limit,customer_id:c.customerId};Array.isArray(C.value)&&C.value.length===2&&(l.start_time=B(new Date(C.value[0])),l.end_time=B(new Date(C.value[1]))),n.order_sn&&(l.order_sn=n.order_sn),n.goods&&(l.goods=n.goods),n.barcode&&(l.barcode=n.barcode),n.customer_phone&&(l.customer_phone=n.customer_phone),n.cate_id&&(l.cate_id=n.cate_id),n.brand&&(l.brand=n.brand),n.status!==""&&n.status!==null&&n.status!==void 0&&(l.status=n.status),n.staff&&(l.staff=n.staff);const t=await Y.orderList(l);t.code===1e4&&(V.value=t.data||[],$.value=t.total||0)}catch(l){console.error("获取客户销售历史失败:",l),O.error("获取客户销售历史失败")}finally{v.value=!1}},A=l=>{U("view-detail",l)},K=l=>({0:"未付清",1:"付清",2:"已还部分",3:"已结清"})[l]||"未知",h=l=>({0:"danger",1:"success",2:"warning",3:"info"})[l]||"info";return E(f,l=>{l&&c.customerId&&x()}),(l,t)=>{const o=r("el-date-picker"),p=r("el-form-item"),w=r("el-input"),D=r("el-option"),F=r("el-select"),b=r("el-button"),_=r("el-form"),L=r("el-table-column"),X=r("el-tag"),Z=r("el-table"),ee=r("el-pagination"),te=r("el-dialog"),le=se("loading");return N(),R(te,{modelValue:f.value,"onUpdate:modelValue":t[9]||(t[9]=i=>f.value=i),title:"客户销售历史",width:"80%","before-close":u,class:"customer-sales-history-dialog"},{footer:s(()=>[a(b,{onClick:u},{default:s(()=>t[12]||(t[12]=[I("关闭")])),_:1})]),default:s(()=>[d("div",Be,[l.customerInfo?(N(),q("div",Se,[d("div",Fe,[d("h3",null,k(l.customerInfo.name),1),d("p",null,"电话："+k(l.customerInfo.phone||"—"),1)]),d("div",Le,[d("span",null," 收款金额："+k(l.customerInfo.debt)+" 元 ",1)]),d("div",Ye,[d("span",null," 销售金额："+k(l.customerInfo.debt)+" 元 ",1)]),d("div",He,[d("span",null," 当前欠款："+k(l.customerInfo.debt)+" 元 ",1)])])):W("",!0),d("div",Me,[a(_,{inline:!0,model:n,class:"search-form","label-width":"auto"},{default:s(()=>[a(p,{label:"时间："},{default:s(()=>[a(o,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=i=>C.value=i),style:{width:"260px"},type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss",shortcuts:S},null,8,["modelValue"])]),_:1}),a(p,{label:"销售单据编号："},{default:s(()=>[a(w,{modelValue:n.order_sn,"onUpdate:modelValue":t[1]||(t[1]=i=>n.order_sn=i),placeholder:"请输入销售单号",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"条形码："},{default:s(()=>[a(w,{modelValue:n.barcode,"onUpdate:modelValue":t[2]||(t[2]=i=>n.barcode=i),placeholder:"请输入条形码",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"商品："},{default:s(()=>[a(w,{modelValue:n.goods,"onUpdate:modelValue":t[3]||(t[3]=i=>n.goods=i),placeholder:"请输入商品",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"分类："},{default:s(()=>[a(w,{modelValue:n.cate_id,"onUpdate:modelValue":t[4]||(t[4]=i=>n.cate_id=i),placeholder:"请输入商品分类",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"品牌："},{default:s(()=>[a(w,{modelValue:n.brand,"onUpdate:modelValue":t[5]||(t[5]=i=>n.brand=i),placeholder:"请输入品牌",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"结算状态："},{default:s(()=>[a(F,{modelValue:n.status,"onUpdate:modelValue":t[6]||(t[6]=i=>n.status=i),placeholder:"请选择结算状态",clearable:"",style:{width:"200px"}},{default:s(()=>[a(D,{label:"未审核",value:0}),a(D,{label:"待付款",value:1}),a(D,{label:"已还部分",value:2}),a(D,{label:"已结清",value:3})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"业务员："},{default:s(()=>[a(w,{modelValue:n.staff,"onUpdate:modelValue":t[7]||(t[7]=i=>n.staff=i),placeholder:"请输入业务员",clearable:"",onKeyup:P(e,["enter"])},null,8,["modelValue"])]),_:1}),a(p,null,{default:s(()=>[a(b,{type:"primary",onClick:e},{default:s(()=>t[10]||(t[10]=[I("查询")])),_:1}),a(b,{onClick:m},{default:s(()=>t[11]||(t[11]=[I("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),d("div",Ae,[ne((N(),R(Z,{data:V.value,border:"",stripe:"",height:"400",onRowClick:A,style:{cursor:"pointer"}},{default:s(()=>[a(L,{type:"index",label:"序号",width:"60"}),a(L,{prop:"order_sn",label:"销售单号","min-width":"120"}),a(L,{prop:"order_price",label:"销售金额(元)",width:"120"},{default:s(i=>[d("span",Ke,k(i.row.order_price),1)]),_:1}),a(L,{prop:"pay_price",label:"收款金额(元)",width:"120"},{default:s(i=>[d("span",qe,k(i.row.pay_price),1)]),_:1}),a(L,{prop:"qian_price",label:"应收金额(元)",width:"120"},{default:s(i=>[d("span",Pe,k(i.row.qian_price),1)]),_:1}),a(L,{prop:"status",label:"状态",width:"100"},{default:s(i=>[a(X,{type:h(i.row.status)},{default:s(()=>[I(k(K(i.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(L,{prop:"created_at",label:"制单时间",width:"180"})]),_:1},8,["data"])),[[le,v.value]]),a(ee,{class:"mt15",background:"",layout:"prev, pager, next, ->, total, jumper","current-page":g.page,"onUpdate:currentPage":t[8]||(t[8]=i=>g.page=i),"page-size":g.limit,total:$.value,onCurrentChange:x},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])}}}),je=Q(Re,[["__scopeId","data-v-4d6261e4"]]);export{_e as B,je as C,ze as P,de as _};
