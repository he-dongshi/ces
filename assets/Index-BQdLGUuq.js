import{d as Fe,r as x,m as re,l as ue,u as Ye,o as He,U as Me,a as v,z as Te,c as U,b as _,e as y,g as l,h as o,D as E,I as F,k as w,p as Ue,B as Ae,j as k,s as de,V as Ie,W as Pe,F as J,i as $e,t as A,T as Ke,A as I,X as ze,_ as Be}from"./index-BUVdxLJQ.js";import{P as me}from"./PrintComponent-DWF2ajXU.js";import"./printProvider-D1gq-grw.js";const Re={class:"page p10"},je={class:"left-actions"},qe={key:0},Ee={class:"page p10"},Je={class:"actions"},We={class:"left-actions"},Le={style:{display:"flex","align-items":"center"}},Oe={style:{display:"inline-flex","margin-right":"10px"}},Qe={style:{display:"inline-flex","margin-right":"10px"}},Xe={style:{display:"inline-flex","margin-right":"10px"}},Ge={style:{color:"blue"}},Ze={style:{color:"red"}},W=10,et=Fe({__name:"Index",setup(tt){const H=x(!1),M=x(!1),T=re([{id:"1",operate:"",name:"操作",showName:"操作",align:"default",column:!0,flex:"default"},{id:"2",operate:"",name:"编号",showName:"编号",align:"default",column:!0,flex:"default"},{id:"3",operate:"",name:"日期",showName:"日期",align:"default",column:!0,flex:"default"},{id:"4",operate:"",name:"创建人",showName:"创建人",align:"default",column:!0,flex:"default"},{id:"5",operate:"",name:"盘点分类",showName:"盘点分类",align:"default",column:!0,flex:"default"},{id:"6",operate:"",name:"盘点总数",showName:"盘点总数",align:"default",column:!0,flex:"default"},{id:"7",operate:"",name:"盘点盈利(元)",showName:"盘点盈利(元)",align:"default",column:!0,flex:"default"},{id:"8",operate:"",name:"盘点亏损(元)",showName:"盘点亏损(元)",align:"default",column:!0,flex:"default"}]),fe=e=>{T.splice(0,T.length,...e),M.value=!1},pe=()=>{console.log("表格列配置弹窗已关闭")},ce=()=>{M.value=!0},ge=e=>{const{columns:n,data:s}=e;let d=0,u=0,m=0;return s.forEach(t=>{var r,b,p;d+=Number(((r=t.stats)==null?void 0:r.total)||0),u+=Number(((b=t.stats)==null?void 0:b.amount)||0),m+=Number(((p=t.stats)==null?void 0:p.diff)||0)}),n.map((t,r)=>t.type==="index"?"合计":t.type==="selection"?"":t.property==="stats.total"?d:t.property==="stats.amount"?u.toFixed(2):t.property==="stats.diff"?m.toFixed(2):"")},_e=ue(()=>T.filter(e=>e.column===!0)),C=e=>e==="left"?"left":e==="center"?"right":!1,ve=e=>({编号:"sn",日期:"createdAt",创建人:"creator",盘点总数:"stats.total","盘点盈利(元)":"stats.amount","盘点亏损(元)":"stats.diff"})[e]||"",Y=e=>({编号:160,日期:180,创建人:120,盘点分类:180,盘点总数:120,"盘点盈利(元)":140,"盘点亏损(元)":140})[e]||120,c=re({page:1,limit:15,number:""}),L=x(""),ye=[{text:"昨天",value:()=>{const e=new Date;e.setDate(e.getDate()-1),e.setHours(0,0,0,0);const n=new Date(e);return n.setHours(23,59,59,999),[e,n]}},{text:"今天",value:()=>{const e=new Date;e.setHours(0,0,0,0);const n=new Date;return n.setHours(23,59,59,999),[e,n]}},{text:"本月",value:()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);return s.setHours(23,59,59,999),[n,s]}},{text:"上月",value:()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth()-1,1),s=new Date(e.getFullYear(),e.getMonth(),0);return s.setHours(23,59,59,999),[n,s]}},{text:"本年",value:()=>{const e=new Date,n=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),11,31);return s.setHours(23,59,59,999),[n,s]}},{text:"上年",value:()=>{const e=new Date,n=new Date(e.getFullYear()-1,0,1),s=new Date(e.getFullYear()-1,11,31);return s.setHours(23,59,59,999),[n,s]}}],P=Ye(),S=x(""),$=x([]),K=x(!1),N=x(1),O=x(0),Q=x("0"),X=x(!0),G=x([]);async function D(){var e,n,s,d,u,m,f;try{K.value=!0;const t={page:N.value,limit:W,pid:Q.value};S.value.trim()&&(t.keyword=S.value.trim());const r=await I.list("inventory_plan",t),b=((n=(e=r==null?void 0:r.data)==null?void 0:e.list)==null?void 0:n.data)||[];O.value=Number(((d=(s=r==null?void 0:r.data)==null?void 0:s.list)==null?void 0:d.total)||0),N.value=Number(((m=(u=r==null?void 0:r.data)==null?void 0:u.list)==null?void 0:m.current_page)||N.value),X.value=!!(((f=r==null?void 0:r.data)==null?void 0:f.btn_show)??!0),$.value=b.map(p=>be(p))}finally{K.value=!1}}function be(e){var n,s;return{id:String(e.id??e.plan_id??e.order_sn??Math.random()),sn:String(e.order_sn??e.sn??e.number??e.id??""),createdAt:String(e.created_at??""),creator:String(((n=e.creator)==null?void 0:n.nickname)||((s=e.creator)==null?void 0:s.username)||e.user_name||""),categories:e.cate_name?String(e.cate_name).split(","):e.categories||[],stats:{total:Number(e.num||e.total||0),amount:Number(e.price||e.amount||0),diff:Number(e.loss_price||e.diff||0)},is_submit:Number(e.is_submit||0),is_over:Number(e.is_over||0)}}function he(){P.push({name:"createInventory"})}function xe(e){P.push({name:"inventoryJoin",query:{id:e.id}})}function we(e){P.push({name:"inventoryDetail",query:{id:e.id}})}function V(){N.value=1,D()}function ke(){S.value="",N.value=1,D()}function Ne(e){G.value=e}async function Z(e){var n,s,d,u,m;try{const f=await I.list("inventory_plan",{pid:e}),t=((n=f==null?void 0:f.data)==null?void 0:n.main)||(f==null?void 0:f.data)||{};let r=[],b="0.00",p="0.00";try{const a=await I.list("inventory_plan_goods",{id:e,limit:9999,page:1}),i=(a==null?void 0:a.data)||{};r=((i==null?void 0:i.list)||((s=i==null?void 0:i.list)==null?void 0:s.data)||(i==null?void 0:i.goods)||(i==null?void 0:i.data)||[]).map(g=>{var ae,le,oe,se,ie;const q=g.goods||{},Se=g.goods_name||q.name||((ae=g.product)==null?void 0:ae.name)||g.name||"—",ee=g.unit_name||((le=q.unit)==null?void 0:le.name)||((oe=g.unit)==null?void 0:oe.name)||((ie=(se=g.product)==null?void 0:se.unit)==null?void 0:ie.name)||"件",te=Number(g.before_stock??g.before_quantity??g.stock??q.stock??0),ne=Number(g.after_stock??g.real_quantity??g.real??0),De=te-ne;return{name:Se,stockText:`${te}${ee}`,realText:`${ne}${ee}`,diffText:String(De)}}),i!=null&&i.plan?(b=String(Number(i.plan.price||0).toFixed(2)),p=String(Number(i.plan.loss_price||0).toFixed(2))):(b=String(Number(t.price||t.amount||0).toFixed(2)),p=String(Number(t.loss_price||t.diff||0).toFixed(2)))}catch(a){console.error("获取盘点明细失败:",a)}const z=(t==null?void 0:t.staff_name)||(t==null?void 0:t.user_name)||((d=t==null?void 0:t.user)==null?void 0:d.name)||((u=t==null?void 0:t.creator)==null?void 0:u.nickname)||((m=t==null?void 0:t.creator)==null?void 0:m.username)||String((t==null?void 0:t.user_id)||"")||"—",B=(t==null?void 0:t.cate_names)||(t==null?void 0:t.cate_name)||(Array.isArray(t==null?void 0:t.categories)?t.categories.join("、"):"")||"",R=(t==null?void 0:t.created_at)||(t==null?void 0:t.start_time)||(t==null?void 0:t.start)||"",j=(t==null?void 0:t.updated_at)||(t==null?void 0:t.over_time)||(t==null?void 0:t.end_time)||(t==null?void 0:t.finish_time)||(t==null?void 0:t.end)||"";return{...t,header:{staff:z,cates:B,start:R,end:j},items:r,profitPrice:b,lossPrice:p}}catch(f){throw console.error("获取盘点详情失败:",f),f}}const Ve=ue(()=>{const e=S.value.trim();return e?$.value.filter(n=>n.sn.includes(e)||(n.categories||[]).join(",").includes(e)):$.value}),Ce=()=>{const e={page:N.value,limit:W,pid:Q.value};S.value.trim()&&(e.keyword=S.value.trim());const n=`盘点单列表_${new Date().toISOString().split("T")[0]}.xlsx`;ze(()=>I.exportInventoryPlan(e),n)};return He(D),Me(()=>{D()}),(e,n)=>{const s=v("el-input"),d=v("el-form-item"),u=v("el-col"),m=v("el-button"),f=v("el-row"),t=v("el-date-picker"),r=v("el-form"),b=v("el-card"),p=v("el-table-column"),z=v("el-icon"),B=v("el-table"),R=v("el-pagination"),j=Te("loading");return _(),U(J,null,[y("div",Re,[l(b,{shadow:"never"},{default:o(()=>[y("div",je,[l(r,{"label-position":"left",inline:!1,model:c},{default:o(()=>[l(f,{gutter:24},{default:o(()=>[l(u,{span:6},{default:o(()=>[l(d,{label:"商品名称：",class:"goods-form-item"},{default:o(()=>[l(s,{modelValue:c.name,"onUpdate:modelValue":n[0]||(n[0]=a=>c.name=a),placeholder:"请输入商品名称",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(d,{label:"销售单据编号：",class:"goods-form-item"},{default:o(()=>[l(s,{modelValue:c.number,"onUpdate:modelValue":n[1]||(n[1]=a=>c.number=a),placeholder:"请输入编号",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(d,{label:"经手人：",class:"goods-form-item"},{default:o(()=>[l(s,{modelValue:c.name,"onUpdate:modelValue":n[2]||(n[2]=a=>c.name=a),placeholder:"请输入经手人",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(m,{type:"primary",onClick:V},{default:o(()=>n[11]||(n[11]=[w("查询")])),_:1}),l(m,{onClick:ke},{default:o(()=>n[12]||(n[12]=[w("重置")])),_:1}),l(m,{class:Ue({topShow:H.value}),onClick:n[3]||(n[3]=a=>H.value=!H.value)},{default:o(()=>n[13]||(n[13]=[w(" 高级筛选 ")])),_:1},8,["class"])]),_:1})]),_:1}),H.value?(_(),U("div",qe,[l(f,{gutter:24},{default:o(()=>[l(u,{span:12},{default:o(()=>[l(d,{label:"时间：",class:"goods-form-item"},{default:o(()=>[l(t,{modelValue:L.value,"onUpdate:modelValue":n[4]||(n[4]=a=>L.value=a),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss",shortcuts:ye},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(d,{label:"条形码：",class:"goods-form-item"},{default:o(()=>[l(s,{modelValue:c.phone,"onUpdate:modelValue":n[5]||(n[5]=a=>c.phone=a),placeholder:"请输入条形码"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(d,{label:"分类："},{default:o(()=>[l(s,{modelValue:c.name,"onUpdate:modelValue":n[6]||(n[6]=a=>c.name=a),placeholder:"请输入商品名称",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,{gutter:24},{default:o(()=>[l(u,{span:6},{default:o(()=>[l(d,{label:"品牌：",class:"goods-form-item"},{default:o(()=>[l(s,{modelValue:c.name,"onUpdate:modelValue":n[7]||(n[7]=a=>c.name=a),placeholder:"请输入品牌",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:o(()=>[l(d,{label:"盘点仓库"},{default:o(()=>[l(s,{modelValue:c.name,"onUpdate:modelValue":n[8]||(n[8]=a=>c.name=a),placeholder:"请输入出库仓库",clearable:"",onKeyup:F(V,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])):E("",!0)]),_:1},8,["model"])])]),_:1})]),y("div",Ee,[l(b,{shadow:"never"},{default:o(()=>[y("div",Je,[y("div",We,[X.value?(_(),k(m,{key:0,type:"primary",onClick:he},{default:o(()=>n[14]||(n[14]=[w("新建盘点单")])),_:1})):E("",!0),l(me,{"selected-data":G.value,"page-type":"inventory","get-detail-data":Z},null,8,["selected-data"]),l(m,{type:"success",onClick:Ce},{default:o(()=>n[15]||(n[15]=[w("导出")])),_:1}),l(m,{onClick:D},{default:o(()=>n[16]||(n[16]=[w("刷新")])),_:1})])]),Ae((_(),k(B,{ref:"multipleTableRef",data:Ve.value,border:"",stripe:"","header-cell-style":de(Ie),"summary-method":ge,style:{"table-layout":"auto"},"show-summary":"",onSelectionChange:Ne},{default:o(()=>[l(p,{fixed:"left",type:"selection",width:"55",align:"center"}),l(p,{fixed:"left",type:"index",width:"60",align:"center"},{header:o(()=>[y("div",{style:{cursor:"pointer",color:"red"},onClick:ce},[l(z,null,{default:o(()=>[l(de(Pe),{size:30})]),_:1})])]),_:1}),(_(!0),U(J,null,$e(_e.value,a=>(_(),U(J,{key:a.id},[a.name==="操作"?(_(),k(p,{key:0,label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":"240"},{default:o(i=>[y("div",Le,[y("div",Oe,[l(me,{"selected-data":[i.row],"page-type":"inventory","get-detail-data":Z,"is-text-button":"",share:""},null,8,["selected-data"])]),y("div",Qe,[i.row.is_over==1?(_(),k(m,{key:0,type:"primary",link:"",onClick:h=>xe(i.row)},{default:o(()=>n[17]||(n[17]=[w("加入盘点")])),_:2},1032,["onClick"])):E("",!0)]),y("div",Xe,[l(m,{type:"primary",link:"",onClick:h=>we(i.row)},{default:o(()=>n[18]||(n[18]=[w("详情")])),_:2},1032,["onClick"])])])]),_:2},1032,["label","align","fixed"])):a.name==="盘点分类"?(_(),k(p,{key:1,label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":Y(a.name)},{default:o(i=>[w(A((i.row.categories||[]).join("、")||"—"),1)]),_:2},1032,["label","align","fixed","min-width"])):a.name==="盘点总数"?(_(),k(p,{key:2,prop:"stats.total",label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":Y(a.name)},{default:o(i=>{var h;return[w(A(((h=i.row.stats)==null?void 0:h.total)||0),1)]}),_:2},1032,["label","align","fixed","min-width"])):a.name==="盘点盈利(元)"?(_(),k(p,{key:3,prop:"stats.amount",label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":Y(a.name)},{default:o(i=>{var h;return[y("span",Ge,A(Number(((h=i.row.stats)==null?void 0:h.amount)||0).toFixed(2)),1)]}),_:2},1032,["label","align","fixed","min-width"])):a.name==="盘点亏损(元)"?(_(),k(p,{key:4,prop:"stats.diff",label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":Y(a.name)},{default:o(i=>{var h;return[y("span",Ze,A(Number(((h=i.row.stats)==null?void 0:h.diff)||0).toFixed(2)),1)]}),_:2},1032,["label","align","fixed","min-width"])):(_(),k(p,{key:5,prop:ve(a.name),label:a.showName,align:a.align==="default"?"":a.align,fixed:C(a.flex),"min-width":Y(a.name)},null,8,["prop","label","align","fixed","min-width"]))],64))),128))]),_:1},8,["data","header-cell-style"])),[[j,K.value]]),l(R,{class:"mt10",background:"",layout:"prev, pager, next,->,total,jumper","current-page":N.value,"onUpdate:currentPage":n[9]||(n[9]=a=>N.value=a),"page-size":W,total:O.value,onCurrentChange:D},null,8,["current-page","total"])]),_:1})]),l(Ke,{modelValue:M.value,"onUpdate:modelValue":n[10]||(n[10]=a=>M.value=a),"header-title":T,onSave:fe,onClose:pe},null,8,["modelValue","header-title"])],64)}}}),ot=Be(et,[["__scopeId","data-v-ed6b74e4"]]);export{ot as default};
